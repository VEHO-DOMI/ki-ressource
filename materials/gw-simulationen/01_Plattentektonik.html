<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plattentektonik Simulation</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1a0a0a 0%, #3d1010 50%, #5c1a00 100%);
            color: #f0f0f0;
            height: 100vh;
            overflow: hidden;
        }

        header {
            background: rgba(0, 0, 0, 0.4);
            padding: 12px 20px;
            border-bottom: 2px solid rgba(255, 127, 39, 0.3);
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px;
        }

        header h1 {
            font-size: 1.5em;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 280px;
            gap: 12px;
            height: calc(100vh - 70px);
            padding: 12px;
        }

        .controls {
            background: rgba(20, 10, 10, 0.8);
            border: 1px solid rgba(255, 127, 39, 0.2);
            border-radius: 8px;
            padding: 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .controls::-webkit-scrollbar {
            width: 6px;
        }

        .controls::-webkit-scrollbar-track {
            background: rgba(255, 127, 39, 0.1);
            border-radius: 3px;
        }

        .controls::-webkit-scrollbar-thumb {
            background: rgba(255, 127, 39, 0.3);
            border-radius: 3px;
        }

        .controls::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 127, 39, 0.5);
        }

        .control-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .section-title {
            font-size: 0.75em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255, 127, 39, 0.8);
            margin-bottom: 4px;
        }

        .button-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        button {
            background: linear-gradient(135deg, rgba(255, 127, 39, 0.2), rgba(200, 100, 50, 0.2));
            border: 1px solid rgba(255, 127, 39, 0.4);
            color: #f0f0f0;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75em;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        button:hover {
            background: linear-gradient(135deg, rgba(255, 127, 39, 0.4), rgba(200, 100, 50, 0.4));
            border-color: rgba(255, 127, 39, 0.6);
            transform: translateY(-1px);
        }

        button.active {
            background: linear-gradient(135deg, rgba(255, 127, 39, 0.6), rgba(200, 100, 50, 0.6));
            border-color: rgba(255, 127, 39, 0.8);
            box-shadow: 0 0 12px rgba(255, 127, 39, 0.4);
        }

        .slider-container {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .slider-label {
            font-size: 0.75em;
            color: rgba(255, 255, 255, 0.7);
            display: flex;
            justify-content: space-between;
        }

        input[type="range"] {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: rgba(255, 127, 39, 0.2);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: rgba(255, 127, 39, 0.8);
            cursor: pointer;
            transition: all 0.2s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            background: rgba(255, 127, 39, 1);
            box-shadow: 0 0 8px rgba(255, 127, 39, 0.6);
        }

        input[type="range"]::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: rgba(255, 127, 39, 0.8);
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        input[type="range"]::-moz-range-thumb:hover {
            background: rgba(255, 127, 39, 1);
            box-shadow: 0 0 8px rgba(255, 127, 39, 0.6);
        }

        .toggle-container {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.75em;
        }

        .toggle-switch {
            position: relative;
            width: 28px;
            height: 16px;
            background: rgba(255, 127, 39, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(255, 127, 39, 0.3);
        }

        .toggle-switch.active {
            background: rgba(255, 127, 39, 0.5);
            border-color: rgba(255, 127, 39, 0.6);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 12px;
            height: 12px;
            background: #f0f0f0;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
        }

        .toggle-switch.active::after {
            left: 14px;
        }

        .info-panel {
            background: rgba(255, 127, 39, 0.1);
            border: 1px solid rgba(255, 127, 39, 0.3);
            border-radius: 4px;
            padding: 8px;
            font-size: 0.7em;
            line-height: 1.4;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-title {
            font-weight: 700;
            color: rgba(255, 127, 39, 0.9);
            margin-bottom: 4px;
        }

        canvas {
            background: linear-gradient(to bottom, rgba(100, 150, 200, 0.1), rgba(0, 0, 0, 0.3));
            border-radius: 8px;
            display: block;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <header>
        <h1>Plattentektonik - Bewegung der Erdplatten</h1>
    </header>

    <div class="container">
        <canvas id="canvas"></canvas>

        <div class="controls">
            <div class="control-section">
                <div class="section-title">Plattengrenze</div>
                <div class="button-group">
                    <button class="boundary-btn active" data-mode="convergent">Konvergent</button>
                    <button class="boundary-btn" data-mode="divergent">Divergent</button>
                    <button class="boundary-btn" data-mode="transform">Transformstörung</button>
                </div>
            </div>

            <div class="control-section">
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Geschwindigkeit</span>
                        <span id="speedValue">1.0x</span>
                    </div>
                    <input type="range" id="speedSlider" min="0.3" max="2" step="0.1" value="1">
                </div>
            </div>

            <div class="control-section">
                <div class="toggle-container">
                    <div class="toggle-switch active" id="labelsToggle"></div>
                    <span>Beschriftungen</span>
                </div>
                <div class="toggle-container">
                    <div class="toggle-switch active" id="earthquakesToggle"></div>
                    <span>Erdbeben anzeigen</span>
                </div>
                <div class="toggle-container">
                    <div class="toggle-switch active" id="convectionToggle"></div>
                    <span>Konvektionsströme</span>
                </div>
            </div>

            <div class="info-panel">
                <div class="info-title" id="infoTitle">Konvergente Grenze</div>
                <div id="infoText">
                    Zwei Platten bewegen sich aufeinander zu. Die dichtere ozeanische Platte taucht unter die leichtere kontinentale Platte. Dies führt zu Gebirgsketten, Vulkanen und häufigen Erdbeben.
                    <br><br>
                    <strong>Beispiel:</strong> Himalaya, Anden
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let animationState = {
            mode: 'convergent',
            speed: 1,
            showLabels: true,
            showEarthquakes: true,
            showConvection: true,
            time: 0
        };

        const infoData = {
            convergent: {
                title: 'Konvergente Grenze',
                text: 'Zwei Platten bewegen sich aufeinander zu. Die dichtere ozeanische Platte taucht unter die leichtere kontinentale Platte. Dies führt zu Gebirgsketten, Vulkanen und häufigen Erdbeben.<br><br><strong>Beispiele:</strong> Himalaya, Anden, Pazifischer Feuerring'
            },
            divergent: {
                title: 'Divergente Grenze',
                text: 'Zwei Platten bewegen sich voneinander weg. Heißes Magma steigt aus dem Erdmantel auf und bildet neue Kruste. Dies führt zur Bildung von mittelozeanischen Rücken und Riftzonen.<br><br><strong>Beispiele:</strong> Mittelatlantischer Rücken, Ostafrikanischer Riftgraben'
            },
            transform: {
                title: 'Transformstörung',
                text: 'Zwei Platten gleiten horizontal aneinander vorbei. Es entstehen keine neuen Platten, aber die Reibung führt zu starken Erdbeben und Verwerfungen.<br><br><strong>Beispiele:</strong> San-Andreas-Verwerfung, Nordanatolische Verwerfung'
            }
        };

        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Event listeners
        document.querySelectorAll('.boundary-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.boundary-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                animationState.mode = this.dataset.mode;
                updateInfo();
                animationState.time = 0;
            });
        });

        document.getElementById('speedSlider').addEventListener('input', function() {
            animationState.speed = parseFloat(this.value);
            document.getElementById('speedValue').textContent = this.value + 'x';
        });

        document.getElementById('labelsToggle').addEventListener('click', function() {
            this.classList.toggle('active');
            animationState.showLabels = this.classList.contains('active');
        });

        document.getElementById('earthquakesToggle').addEventListener('click', function() {
            this.classList.toggle('active');
            animationState.showEarthquakes = this.classList.contains('active');
        });

        document.getElementById('convectionToggle').addEventListener('click', function() {
            this.classList.toggle('active');
            animationState.showConvection = this.classList.contains('active');
        });

        function updateInfo() {
            const info = infoData[animationState.mode];
            document.getElementById('infoTitle').textContent = info.title;
            document.getElementById('infoText').innerHTML = info.text;
        }

        // Earthquake and volcano particles
        let earthquakes = [];
        let volcanoes = [];

        function createEarthquake(x, y) {
            earthquakes.push({
                x: x,
                y: y,
                life: 0.8,
                radius: 8
            });
        }

        function createVolcano(x, y) {
            for (let i = 0; i < 5; i++) {
                volcanoes.push({
                    x: x + (Math.random() - 0.5) * 20,
                    y: y,
                    vx: (Math.random() - 0.5) * 2,
                    vy: -Math.random() * 2,
                    life: 1,
                    size: Math.random() * 3 + 1
                });
            }
        }

        function drawBackground() {
            const w = canvas.width;
            const h = canvas.height;

            // Water (ocean)
            ctx.fillStyle = 'rgba(30, 80, 150, 0.3)';
            ctx.fillRect(0, 0, w, h * 0.15);

            // Land surface transition
            ctx.fillStyle = 'rgba(100, 80, 40, 0.2)';
            ctx.fillRect(0, h * 0.15, w, h * 0.05);

            // Sky gradient
            const skyGradient = ctx.createLinearGradient(0, 0, 0, h * 0.15);
            skyGradient.addColorStop(0, 'rgba(100, 150, 200, 0.1)');
            skyGradient.addColorStop(1, 'rgba(100, 80, 40, 0.05)');
            ctx.fillStyle = skyGradient;
            ctx.fillRect(0, 0, w, h * 0.15);

            // Mantle gradient (deep below crust)
            const mantleGradient = ctx.createLinearGradient(0, h * 0.35, 0, h);
            mantleGradient.addColorStop(0, 'rgba(150, 60, 20, 0.3)');
            mantleGradient.addColorStop(0.5, 'rgba(100, 40, 20, 0.3)');
            mantleGradient.addColorStop(1, 'rgba(50, 20, 10, 0.3)');
            ctx.fillStyle = mantleGradient;
            ctx.fillRect(0, h * 0.35, w, h * 0.65);
        }

        function drawConvectionArrows(centerX) {
            if (!animationState.showConvection) return;

            const w = canvas.width;
            const h = canvas.height;
            const baseY = h * 0.5;

            ctx.strokeStyle = 'rgba(255, 127, 39, 0.2)';
            ctx.fillStyle = 'rgba(255, 127, 39, 0.15)';
            ctx.lineWidth = 2;

            // Left convection cell
            const leftOffset = Math.sin(animationState.time * 0.01) * 5;
            drawConvectionCell(w * 0.25 + leftOffset, baseY + 50, 60, 100, true);

            // Right convection cell
            const rightOffset = Math.sin(animationState.time * 0.01 + Math.PI) * 5;
            drawConvectionCell(w * 0.75 + rightOffset, baseY + 50, 60, 100, false);
        }

        function drawConvectionCell(x, y, width, height, leftCurve) {
            const steps = 8;
            for (let i = 0; i < steps; i++) {
                const progress = i / steps;
                const angle = progress * Math.PI;

                const startX = leftCurve ? x - width * Math.cos(angle) : x + width * Math.cos(angle);
                const startY = y - height * 0.5 + progress * height;

                const arrowSize = 6;
                const arrowAngle = leftCurve ? -Math.PI / 4 : Math.PI / 4;

                ctx.beginPath();
                ctx.moveTo(startX, startY);
                ctx.lineTo(startX - Math.cos(arrowAngle) * arrowSize, startY - Math.sin(arrowAngle) * arrowSize);
                ctx.moveTo(startX, startY);
                ctx.lineTo(startX + Math.cos(arrowAngle - Math.PI / 2) * arrowSize, startY + Math.sin(arrowAngle - Math.PI / 2) * arrowSize);
                ctx.stroke();
            }
        }

        function drawConvergentMode() {
            const w = canvas.width;
            const h = canvas.height;
            const centerX = w * 0.5;
            const crustY = h * 0.2;
            const plateThickness = 60;

            // Plate movement
            const offset = Math.sin(animationState.time * 0.005 * animationState.speed) * 30;

            // Left plate
            ctx.fillStyle = 'rgba(180, 140, 80, 0.8)';
            ctx.fillRect(offset, crustY, centerX - offset - 5, plateThickness);
            ctx.strokeStyle = 'rgba(150, 110, 50, 1)';
            ctx.lineWidth = 2;
            ctx.strokeRect(offset, crustY, centerX - offset - 5, plateThickness);

            // Right plate (subducting)
            ctx.fillStyle = 'rgba(160, 120, 70, 0.8)';
            ctx.beginPath();
            ctx.moveTo(centerX + offset + 5, crustY);
            ctx.lineTo(w - offset, crustY);
            ctx.lineTo(w - offset, crustY + plateThickness * 0.7);
            ctx.lineTo(centerX + offset + 5 + 80, crustY + plateThickness * 2);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            // Mountain formation at boundary
            const mountainHeight = 40 + Math.abs(offset) * 0.3;
            ctx.fillStyle = 'rgba(120, 100, 60, 0.9)';
            ctx.beginPath();
            ctx.moveTo(centerX - 30, crustY);
            ctx.lineTo(centerX + 10, crustY - mountainHeight);
            ctx.lineTo(centerX + 50, crustY);
            ctx.closePath();
            ctx.fill();

            // Trench at subduction zone
            ctx.fillStyle = 'rgba(20, 60, 100, 0.5)';
            ctx.beginPath();
            ctx.moveTo(centerX + 30, crustY + plateThickness);
            ctx.quadraticCurveTo(centerX + 50, crustY + plateThickness + 40, centerX + 60, crustY + plateThickness);
            ctx.lineTo(centerX + 70, crustY + plateThickness);
            ctx.quadraticCurveTo(centerX + 50, crustY + plateThickness + 30, centerX + 30, crustY + plateThickness);
            ctx.closePath();
            ctx.fill();

            // Volcanoes
            const volcanoX = centerX - 80;
            const volcanoY = crustY;
            drawVolcano(volcanoX, volcanoY);

            // Periodic eruptions
            if (Math.sin(animationState.time * 0.01 * animationState.speed) > 0.7) {
                createVolcano(volcanoX, volcanoY - 20);
            }

            // Earthquakes at subduction zone
            if (animationState.showEarthquakes && Math.random() > 0.95 * animationState.speed) {
                const quakeX = centerX + Math.random() * 40;
                const quakeY = crustY + Math.random() * 40;
                createEarthquake(quakeX, quakeY);
            }

            // Movement arrows
            ctx.strokeStyle = 'rgba(255, 200, 100, 0.6)';
            ctx.lineWidth = 3;
            ctx.fillStyle = 'rgba(255, 200, 100, 0.6)';
            drawArrow(w * 0.2, crustY + plateThickness / 2, w * 0.35, crustY + plateThickness / 2);
            drawArrow(w * 0.8, crustY + plateThickness / 2, w * 0.65, crustY + plateThickness / 2);

            if (animationState.showLabels) {
                ctx.font = 'bold 12px Inter';
                ctx.fillStyle = 'rgba(200, 200, 200, 0.8)';
                ctx.textAlign = 'center';
                ctx.fillText('Kontinentalplatte', w * 0.25, crustY - 20);
                ctx.fillText('Ozeanische Platte', w * 0.75, crustY - 20);
                ctx.fillText('Subduktion', centerX, crustY + 120);
            }

            drawConvectionArrows(centerX);
        }

        function drawDivergentMode() {
            const w = canvas.width;
            const h = canvas.height;
            const centerX = w * 0.5;
            const crustY = h * 0.2;
            const plateThickness = 60;

            // Plate movement
            const offset = Math.sin(animationState.time * 0.005 * animationState.speed) * 25;

            // Left plate
            ctx.fillStyle = 'rgba(180, 140, 80, 0.8)';
            ctx.fillRect(0, crustY, centerX - 10 - offset, plateThickness);
            ctx.strokeStyle = 'rgba(150, 110, 50, 1)';
            ctx.lineWidth = 2;
            ctx.strokeRect(0, crustY, centerX - 10 - offset, plateThickness);

            // Right plate
            ctx.fillStyle = 'rgba(160, 120, 70, 0.8)';
            ctx.fillRect(centerX + 10 + offset, crustY, w - (centerX + 10 + offset), plateThickness);
            ctx.strokeRect(centerX + 10 + offset, crustY, w - (centerX + 10 + offset), plateThickness);

            // Mid-ocean ridge with magma
            const magmaWidth = 20 + Math.abs(offset) * 0.5;
            const magmaGradient = ctx.createLinearGradient(centerX - magmaWidth/2, crustY, centerX + magmaWidth/2, crustY);
            magmaGradient.addColorStop(0, 'rgba(180, 80, 20, 0.6)');
            magmaGradient.addColorStop(0.5, 'rgba(255, 150, 50, 0.8)');
            magmaGradient.addColorStop(1, 'rgba(180, 80, 20, 0.6)');
            ctx.fillStyle = magmaGradient;
            ctx.fillRect(centerX - magmaWidth/2, crustY - 10, magmaWidth, plateThickness + 20);

            // Ridge structure
            ctx.fillStyle = 'rgba(100, 60, 40, 0.8)';
            ctx.beginPath();
            ctx.moveTo(centerX - magmaWidth/2, crustY);
            ctx.lineTo(centerX - magmaWidth/4, crustY - 15);
            ctx.lineTo(centerX, crustY - 20);
            ctx.lineTo(centerX + magmaWidth/4, crustY - 15);
            ctx.lineTo(centerX + magmaWidth/2, crustY);
            ctx.closePath();
            ctx.fill();

            // Cooling new crust
            ctx.fillStyle = 'rgba(130, 90, 60, 0.7)';
            ctx.fillRect(centerX - magmaWidth/2 - 15, crustY, 15, plateThickness);
            ctx.fillRect(centerX + magmaWidth/2, crustY, 15, plateThickness);

            // Movement arrows
            ctx.strokeStyle = 'rgba(255, 200, 100, 0.6)';
            ctx.lineWidth = 3;
            ctx.fillStyle = 'rgba(255, 200, 100, 0.6)';
            drawArrow(w * 0.2, crustY + plateThickness / 2, w * 0.35, crustY + plateThickness / 2);
            drawArrow(w * 0.8, crustY + plateThickness / 2, w * 0.65, crustY + plateThickness / 2);

            // Hydrothermal vents
            if (Math.random() > 0.85 * animationState.speed) {
                createVolcano(centerX + (Math.random() - 0.5) * magmaWidth * 2, crustY - 10);
            }

            if (animationState.showLabels) {
                ctx.font = 'bold 12px Inter';
                ctx.fillStyle = 'rgba(200, 200, 200, 0.8)';
                ctx.textAlign = 'center';
                ctx.fillText('Nordamerikanische Platte', w * 0.25, crustY - 20);
                ctx.fillText('Eurasische Platte', w * 0.75, crustY - 20);
                ctx.fillText('Mittelozeanischer Rücken', centerX, crustY - 35);
            }

            drawConvectionArrows(centerX);
        }

        function drawTransformMode() {
            const w = canvas.width;
            const h = canvas.height;
            const centerX = w * 0.5;
            const crustY = h * 0.2;
            const plateThickness = 60;

            // Plate movement (sliding)
            const offset = Math.sin(animationState.time * 0.005 * animationState.speed) * 20;

            // Upper plate (moving right)
            ctx.fillStyle = 'rgba(180, 140, 80, 0.8)';
            ctx.fillRect(0, crustY - 30, w, plateThickness);
            ctx.strokeStyle = 'rgba(150, 110, 50, 1)';
            ctx.lineWidth = 2;
            ctx.strokeRect(0, crustY - 30, w, plateThickness);

            // Lower plate (offset)
            ctx.fillStyle = 'rgba(160, 120, 70, 0.8)';
            ctx.fillRect(offset, crustY + plateThickness - 30, w, plateThickness);
            ctx.strokeRect(offset, crustY + plateThickness - 30, w, plateThickness);

            // Fault line with stress visualization
            const stressIntensity = (Math.abs(offset) / 20) * 0.5 + 0.3;
            ctx.strokeStyle = `rgba(255, 150, 50, ${stressIntensity})`;
            ctx.lineWidth = 3;
            ctx.setLineDash([5, 5]);

            // Jagged fault line
            let faultX = centerX - 150;
            let faultY = crustY;
            ctx.beginPath();
            ctx.moveTo(faultX, faultY - 50);
            for (let i = 0; i < 8; i++) {
                faultX += 40;
                faultY += (Math.random() - 0.5) * 30;
                ctx.lineTo(faultX, faultY);
            }
            faultX = centerX + 150;
            faultY = crustY;
            ctx.stroke();
            ctx.setLineDash([]);

            // Stress glow at fault
            if (stressIntensity > 0.6) {
                ctx.fillStyle = `rgba(255, 100, 50, ${(stressIntensity - 0.6) * 0.4})`;
                ctx.beginPath();
                ctx.arc(centerX, crustY, 50, 0, Math.PI * 2);
                ctx.fill();
            }

            // Earthquakes along fault
            if (animationState.showEarthquakes && stressIntensity > 0.65 && Math.random() > 0.9) {
                for (let i = 0; i < 3; i++) {
                    const quakeX = centerX - 100 + Math.random() * 200;
                    const quakeY = crustY + (Math.random() - 0.5) * 30;
                    createEarthquake(quakeX, quakeY);
                }
            }

            // Movement arrows
            ctx.strokeStyle = 'rgba(255, 200, 100, 0.6)';
            ctx.lineWidth = 3;
            ctx.fillStyle = 'rgba(255, 200, 100, 0.6)';
            drawArrow(w * 0.2, crustY - 50, w * 0.35, crustY - 50);
            drawArrow(w * 0.8, crustY + 30, w * 0.65, crustY + 30);

            if (animationState.showLabels) {
                ctx.font = 'bold 12px Inter';
                ctx.fillStyle = 'rgba(200, 200, 200, 0.8)';
                ctx.textAlign = 'center';
                ctx.fillText('Pacifische Platte', w * 0.3, crustY - 50);
                ctx.fillText('Nordamerikanische Platte', w * 0.7, crustY + 70);
                ctx.fillText('Transformstörung', centerX, crustY + 100);
            }

            drawConvectionArrows(centerX);
        }

        function drawVolcano(x, y) {
            ctx.fillStyle = 'rgba(180, 80, 30, 0.8)';
            ctx.beginPath();
            ctx.moveTo(x - 15, y + 5);
            ctx.lineTo(x, y - 20);
            ctx.lineTo(x + 15, y + 5);
            ctx.closePath();
            ctx.fill();
            ctx.strokeStyle = 'rgba(150, 60, 20, 1)';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Crater
            ctx.fillStyle = 'rgba(50, 20, 10, 0.9)';
            ctx.fillRect(x - 4, y - 18, 8, 6);
        }

        function drawArrow(fromX, fromY, toX, toY) {
            const headlen = 15;
            const angle = Math.atan2(toY - fromY, toX - fromX);

            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headlen * Math.cos(angle - Math.PI / 6), toY - headlen * Math.sin(angle - Math.PI / 6));
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headlen * Math.cos(angle + Math.PI / 6), toY - headlen * Math.sin(angle + Math.PI / 6));
            ctx.stroke();
        }

        function updateParticles() {
            earthquakes = earthquakes.filter(eq => eq.life > 0);
            volcanoes = volcanoes.filter(vol => vol.life > 0);

            earthquakes.forEach(eq => {
                eq.life -= 0.02;
                eq.radius += 1;
            });

            volcanoes.forEach(vol => {
                vol.x += vol.vx;
                vol.y += vol.vy;
                vol.vy += 0.1;
                vol.life -= 0.03;
            });
        }

        function drawParticles() {
            // Draw earthquakes
            earthquakes.forEach(eq => {
                ctx.strokeStyle = `rgba(255, 255, 0, ${eq.life * 0.8})`;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(eq.x, eq.y, eq.radius, 0, Math.PI * 2);
                ctx.stroke();

                ctx.strokeStyle = `rgba(255, 200, 0, ${eq.life * 0.5})`;
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.arc(eq.x, eq.y, eq.radius * 0.6, 0, Math.PI * 2);
                ctx.stroke();
            });

            // Draw volcanic particles
            volcanoes.forEach(vol => {
                ctx.fillStyle = `rgba(255, ${Math.floor(150 * vol.life)}, 50, ${vol.life})`;
                ctx.beginPath();
                ctx.arc(vol.x, vol.y, vol.size, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            drawBackground();

            switch (animationState.mode) {
                case 'convergent':
                    drawConvergentMode();
                    break;
                case 'divergent':
                    drawDivergentMode();
                    break;
                case 'transform':
                    drawTransformMode();
                    break;
            }

            updateParticles();
            drawParticles();

            animationState.time += animationState.speed;

            requestAnimationFrame(animate);
        }

        updateInfo();
        animate();
    </script>
</body>
</html>
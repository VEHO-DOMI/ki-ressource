<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zeitleiste der Hochkulturen</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1a0a0a 0%, #3d1020 50%, #5c1030 100%);
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            height: 100vh;
            display: grid;
            grid-template-columns: 1fr 280px;
            gap: 12px;
            padding: 12px;
        }

        .main-area {
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-height: 0;
        }

        .header {
            max-height: 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 0.9em;
            font-weight: 600;
            color: #ffc107;
        }

        .canvas-container {
            flex: 1;
            min-height: 0;
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px;
            position: relative;
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        .controls {
            width: 280px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            overflow-y: auto;
            padding: 4px;
        }

        .controls::-webkit-scrollbar {
            width: 6px;
        }

        .controls::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .controls::-webkit-scrollbar-thumb {
            background: rgba(255, 193, 7, 0.3);
            border-radius: 3px;
        }

        .control-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px;
        }

        .control-title {
            font-size: 0.75em;
            font-weight: 700;
            color: #ffc107;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            display: block;
        }

        .zoom-slider {
            width: 100%;
            height: 4px;
            cursor: pointer;
            accent-color: #ffc107;
        }

        .zoom-label {
            font-size: 0.65em;
            color: rgba(255, 255, 255, 0.7);
            display: flex;
            justify-content: space-between;
            margin-top: 6px;
        }

        .civilization-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            margin-bottom: 6px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            font-size: 0.7em;
        }

        .civilization-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .civilization-toggle input[type="checkbox"] {
            cursor: pointer;
            width: 16px;
            height: 16px;
            accent-color: #ffc107;
        }

        .civ-color-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .info-panel {
            max-height: 400px;
            overflow-y: auto;
        }

        .info-panel::-webkit-scrollbar {
            width: 4px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 2px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: rgba(255, 193, 7, 0.3);
            border-radius: 2px;
        }

        .info-civ-name {
            font-size: 0.85em;
            font-weight: 700;
            color: #ffc107;
            margin-bottom: 8px;
        }

        .info-dates {
            font-size: 0.65em;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 10px;
            font-style: italic;
        }

        .info-achievement {
            font-size: 0.7em;
            color: rgba(255, 255, 255, 0.85);
            margin-bottom: 8px;
            padding: 6px;
            background: rgba(255, 193, 7, 0.1);
            border-left: 2px solid #ffc107;
            border-radius: 4px;
        }

        .info-facts {
            font-size: 0.65em;
            color: rgba(255, 255, 255, 0.75);
            line-height: 1.4;
        }

        .info-facts li {
            margin-left: 16px;
            margin-bottom: 4px;
        }

        .zoom-info {
            font-size: 0.65em;
            color: rgba(255, 255, 255, 0.6);
            padding: 8px;
            background: rgba(255, 193, 7, 0.05);
            border-radius: 8px;
            text-align: center;
        }

        .close-info {
            font-size: 0.7em;
            padding: 6px 10px;
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid rgba(255, 193, 7, 0.4);
            color: #ffc107;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
            width: 100%;
            font-weight: 600;
        }

        .close-info:hover {
            background: rgba(255, 193, 7, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-area">
            <div class="header">
                <span>Zeitleiste der Hochkulturen</span>
                <span id="timeRange" style="font-size: 0.75em; color: rgba(255, 255, 255, 0.7);">4000 v.Chr. - 500 n.Chr.</span>
            </div>
            <div class="canvas-container">
                <canvas id="timelineCanvas"></canvas>
            </div>
        </div>

        <div class="controls">
            <div class="control-section">
                <label class="control-title">Zoom & Ansicht</label>
                <input type="range" id="zoomSlider" class="zoom-slider" min="1" max="10" value="1">
                <div class="zoom-label">
                    <span>Gesamt</span>
                    <span>Detail</span>
                </div>
                <div class="zoom-info" id="zoomInfo">Zeitfenster: 4500 Jahre</div>
            </div>

            <div class="control-section">
                <label class="control-title">Hochkulturen</label>
                <div id="civilizationToggles"></div>
            </div>

            <div class="control-section">
                <label class="control-title">Details</label>
                <div id="infoPanel" style="display: none;">
                    <div id="infoPanelContent"></div>
                    <button class="close-info" onclick="closeInfo()">Schließen</button>
                </div>
                <div id="noSelection" style="font-size: 0.7em; color: rgba(255, 255, 255, 0.6);">
                    Klicke auf eine Hochkultur im Diagramm, um mehr zu erfahren.
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== DATA ====================
        const civilizations = [
            {
                id: 'mesopotamia',
                name: 'Mesopotamien (Sumerer)',
                nameShort: 'Mesopotamien',
                startYear: -3500,
                endYear: -539,
                color: '#FF6B35',
                colorRgb: [255, 107, 53],
                achievement: 'Erfindung der Schrift und des Rades',
                facts: [
                    'Entwicklung der Keilschrift (um 3400 v.Chr.)',
                    'Pyramidenförmige Tempel (Zikurate)',
                    'Mathematik und Astronomie'
                ]
            },
            {
                id: 'egypt',
                name: 'Ägypten',
                nameShort: 'Ägypten',
                startYear: -3100,
                endYear: -30,
                color: '#FFB347',
                colorRgb: [255, 179, 71],
                achievement: 'Bau der Pyramiden und Nilkultur',
                facts: [
                    'Monumentale Bauwerke (Pyramiden, Tempel)',
                    'Hierarchisches Staatssystem unter Pharaonen',
                    'Papyrus und frühe Medizin'
                ]
            },
            {
                id: 'indus',
                name: 'Indus-Kultur',
                nameShort: 'Indus',
                startYear: -2600,
                endYear: -1900,
                color: '#4ECDC4',
                colorRgb: [78, 205, 196],
                achievement: 'Hochentwickelte Stadtplanung',
                facts: [
                    'Geplante Städte (Harappa, Mohenjo-daro)',
                    'Standardisierte Gewichte und Maße',
                    'Rätselhaftes Schriftsystem'
                ]
            },
            {
                id: 'greece',
                name: 'Griechenland',
                nameShort: 'Griechenland',
                startYear: -800,
                endYear: -146,
                color: '#95E1D3',
                colorRgb: [149, 225, 211],
                achievement: 'Philosophie, Demokratie und Wissenschaft',
                facts: [
                    'Athenische Demokratie und Philosophen',
                    'Olympische Spiele und Theater',
                    'Grundlagen der Geometrie und Logik'
                ]
            },
            {
                id: 'persia',
                name: 'Perserreich',
                nameShort: 'Perserreich',
                startYear: -550,
                endYear: -330,
                color: '#F38181',
                colorRgb: [243, 129, 129],
                achievement: 'Größtes Reich der Antike bis dahin',
                facts: [
                    'Verwaltung eines riesigen Reiches',
                    'Straßennetze und Postsystem',
                    'Religionstoleranz und multikulturelle Gesellschaft'
                ]
            },
            {
                id: 'rome',
                name: 'Rom',
                nameShort: 'Rom',
                startYear: -753,
                endYear: 476,
                color: '#AA96DA',
                colorRgb: [170, 150, 218],
                achievement: 'Rechtssystem, Ingenieurwesen und Militär',
                facts: [
                    'Römisches Recht und Gesetzgebung',
                    'Aquädukte, Straßen und Architektur',
                    'Legionärsystem und komplexe Verwaltung'
                ]
            }
        ];

        const epochs = [
            { year: -3000, label: 'Bronzezeit', color: 'rgba(255,255,255,0.15)' },
            { year: -1200, label: 'Eisenzeit', color: 'rgba(255,255,255,0.1)' },
            { year: 0, label: 'Zeitenwende', color: 'rgba(255,193,7,0.2)' }
        ];

        // ==================== STATE ====================
        let state = {
            zoomLevel: 1,
            scrollX: 0,
            selectedCivilization: null,
            visibleCivilizations: new Set(civilizations.map(c => c.id)),
            pixelsPerYear: 0,
            startYear: -4500,
            endYear: 500
        };

        // ==================== CANVAS SETUP ====================
        const canvas = document.getElementById('timelineCanvas');
        const ctx = canvas.getContext('2d');
        const dpr = window.devicePixelRatio || 1;

        function resizeCanvas() {
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';
            draw();
        }

        // ==================== TIMELINE CALCULATIONS ====================
        function updateTimeline() {
            const rect = canvas.getBoundingClientRect();
            const yearSpan = state.endYear - state.startYear;
            state.pixelsPerYear = (rect.width - 60) / yearSpan;
        }

        function yearToPixels(year) {
            return 30 + (year - state.startYear) * state.pixelsPerYear;
        }

        function pixelsToYear(px) {
            return state.startYear + (px - 30) / state.pixelsPerYear;
        }

        // ==================== ZOOM HANDLING ====================
        document.getElementById('zoomSlider').addEventListener('input', (e) => {
            state.zoomLevel = parseFloat(e.target.value);
            const fullSpan = 4500;
            const newSpan = Math.max(500, fullSpan / state.zoomLevel);
            state.endYear = -4500 + newSpan;
            updateZoomInfo();
            updateTimeline();
            draw();
        });

        function updateZoomInfo() {
            const span = state.endYear - state.startYear;
            const years = Math.round(span);
            document.getElementById('zoomInfo').textContent = `Zeitfenster: ${years} Jahre`;
            document.getElementById('timeRange').textContent = `${Math.round(state.startYear)} - ${Math.round(state.endYear)}`;
        }

        // ==================== CIVILIZATION TOGGLES ====================
        function setupCivilizationToggles() {
            const container = document.getElementById('civilizationToggles');
            container.innerHTML = '';

            civilizations.forEach(civ => {
                const label = document.createElement('label');
                label.className = 'civilization-toggle';

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = state.visibleCivilizations.has(civ.id);
                checkbox.addEventListener('change', (e) => {
                    if (e.target.checked) {
                        state.visibleCivilizations.add(civ.id);
                    } else {
                        state.visibleCivilizations.delete(civ.id);
                        if (state.selectedCivilization === civ.id) {
                            closeInfo();
                        }
                    }
                    draw();
                });

                const dot = document.createElement('div');
                dot.className = 'civ-color-dot';
                dot.style.backgroundColor = civ.color;

                const text = document.createElement('span');
                text.textContent = civ.nameShort;

                label.appendChild(checkbox);
                label.appendChild(dot);
                label.appendChild(text);
                container.appendChild(label);
            });
        }

        // ==================== DRAWING ====================
        function draw() {
            const width = canvas.offsetWidth;
            const height = canvas.offsetHeight;

            // Background
            ctx.fillStyle = 'rgba(255, 255, 255, 0.02)';
            ctx.fillRect(0, 0, width, height);

            updateTimeline();

            // Draw epochs
            drawEpochs(width, height);

            // Draw timeline axis
            drawAxis(width, height);

            // Draw civilizations
            drawCivilizations(width, height);

            // Draw selection highlight
            if (state.selectedCivilization) {
                drawSelectionHighlight(width, height);
            }
        }

        function drawEpochs(width, height) {
            epochs.forEach(epoch => {
                const x = yearToPixels(epoch.year);
                if (x > 0 && x < width) {
                    ctx.fillStyle = epoch.color;
                    ctx.fillRect(x - 1, 0, 2, height);

                    ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                    ctx.font = '9px Inter';
                    ctx.textAlign = 'center';
                    ctx.save();
                    ctx.translate(x + 15, height - 8);
                    ctx.rotate(-Math.PI / 4);
                    ctx.fillText(epoch.label, 0, 0);
                    ctx.restore();
                }
            });
        }

        function drawAxis(width, height) {
            const axisY = height - 30;

            // Axis line
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(30, axisY);
            ctx.lineTo(width - 30, axisY);
            ctx.stroke();

            // Year markers
            const yearStep = getYearStep();
            let year = Math.ceil(state.startYear / yearStep) * yearStep;

            ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.font = '8px Inter';
            ctx.textAlign = 'center';

            while (year <= state.endYear) {
                const x = yearToPixels(year);
                if (x > 0 && x < width) {
                    ctx.beginPath();
                    ctx.moveTo(x, axisY);
                    ctx.lineTo(x, axisY + 4);
                    ctx.stroke();

                    const label = year < 0 ? `${-year} v.Chr.` : `${year} n.Chr.`;
                    ctx.fillText(label, x, axisY + 14);
                }
                year += yearStep;
            }
        }

        function getYearStep() {
            const span = state.endYear - state.startYear;
            if (span > 4000) return 1000;
            if (span > 2000) return 500;
            if (span > 1000) return 250;
            if (span > 500) return 100;
            return 50;
        }

        function drawCivilizations(width, height) {
            const barHeight = 30;
            const spacing = 10;
            const startY = 50;
            let currentY = startY;

            Array.from(state.visibleCivilizations).forEach((civId, index) => {
                const civ = civilizations.find(c => c.id === civId);
                if (!civ) return;

                drawCivilizationBar(civ, currentY, barHeight, width, height);
                currentY += barHeight + spacing;
            });
        }

        function drawCivilizationBar(civ, y, height, width, canvasHeight) {
            const startX = yearToPixels(civ.startYear);
            const endX = yearToPixels(civ.endYear);
            const barWidth = Math.max(2, endX - startX);

            // Main bar
            ctx.fillStyle = civ.color;
            ctx.fillRect(startX, y, barWidth, height);

            // Glow effect
            ctx.shadowColor = civ.color;
            ctx.shadowBlur = 8;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
            ctx.fillRect(startX, y, barWidth, height);
            ctx.shadowBlur = 0;

            // Hover effect
            const mousePos = canvas.mousePos;
            if (mousePos && isPointInBar(mousePos.x, mousePos.y, startX, y, barWidth, height)) {
                ctx.strokeStyle = '#ffc107';
                ctx.lineWidth = 2;
                ctx.strokeRect(startX - 1, y - 1, barWidth + 2, height + 2);
            }

            // Selected effect
            if (state.selectedCivilization === civ.id) {
                ctx.strokeStyle = '#ffc107';
                ctx.lineWidth = 3;
                ctx.strokeRect(startX - 2, y - 2, barWidth + 4, height + 4);
            }

            // Label
            if (barWidth > 40) {
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 10px Inter';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(civ.nameShort, startX + barWidth / 2, y + height / 2);
            }
        }

        function drawSelectionHighlight(width, height) {
            const civ = civilizations.find(c => c.id === state.selectedCivilization);
            if (!civ) return;

            const startX = yearToPixels(civ.startYear);
            const endX = yearToPixels(civ.endYear);

            ctx.fillStyle = 'rgba(255, 193, 7, 0.1)';
            ctx.fillRect(startX, 0, endX - startX, height);
        }

        function isPointInBar(px, py, bx, by, bw, bh) {
            return px >= bx && px <= bx + bw && py >= by && py <= by + bh;
        }

        // ==================== MOUSE INTERACTION ====================
        canvas.mousePos = null;

        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            canvas.mousePos = {
                x: (e.clientX - rect.left) / (rect.width / canvas.offsetWidth),
                y: (e.clientY - rect.top) / (rect.height / canvas.offsetHeight)
            };
            draw();
        });

        canvas.addEventListener('mouseleave', () => {
            canvas.mousePos = null;
            draw();
        });

        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) / (rect.width / canvas.offsetWidth);
            const y = (e.clientY - rect.top) / (rect.height / canvas.offsetHeight);

            const barHeight = 30;
            const spacing = 10;
            const startY = 50;
            let currentY = startY;

            Array.from(state.visibleCivilizations).forEach((civId) => {
                const civ = civilizations.find(c => c.id === civId);
                if (!civ) return;

                const startX = yearToPixels(civ.startYear);
                const endX = yearToPixels(civ.endYear);

                if (isPointInBar(x, y, startX, currentY, endX - startX, barHeight)) {
                    selectCivilization(civ.id);
                }

                currentY += barHeight + spacing;
            });
        });

        // ==================== INFO PANEL ====================
        function selectCivilization(civId) {
            state.selectedCivilization = civId;
            const civ = civilizations.find(c => c.id === civId);

            const infoPanel = document.getElementById('infoPanel');
            const noSelection = document.getElementById('noSelection');
            const content = document.getElementById('infoPanelContent');

            const startDate = civ.startYear < 0 ? `${-civ.startYear} v.Chr.` : `${civ.startYear} n.Chr.`;
            const endDate = civ.endYear < 0 ? `${-civ.endYear} v.Chr.` : `${civ.endYear} n.Chr.`;

            content.innerHTML = `
                <div class="info-civ-name">${civ.name}</div>
                <div class="info-dates">${startDate} – ${endDate}</div>
                <div class="info-achievement">
                    <strong>Hauptleistung:</strong><br>
                    ${civ.achievement}
                </div>
                <div class="info-facts">
                    <strong>Wichtige Aspekte:</strong>
                    <ul>
                        ${civ.facts.map(f => `<li>${f}</li>`).join('')}
                    </ul>
                </div>
            `;

            infoPanel.style.display = 'block';
            noSelection.style.display = 'none';
            draw();
        }

        function closeInfo() {
            state.selectedCivilization = null;
            document.getElementById('infoPanel').style.display = 'none';
            document.getElementById('noSelection').style.display = 'block';
            draw();
        }

        // ==================== INITIALIZATION ====================
        setupCivilizationToggles();
        updateZoomInfo();

        window.addEventListener('resize', () => {
            resizeCanvas();
        });

        setTimeout(() => {
            resizeCanvas();
        }, 50);

        function animate() {
            draw();
            requestAnimationFrame(animate);
        }

        animate();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entdeckungsreisen und Kolonialismus - Simulation</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1a0a0a 0%, #3d1020 50%, #5c1030 100%);
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 8px 12px;
            gap: 6px;
        }

        .header {
            max-height: 36px;
            padding: 8px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header h1 {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: -0.3px;
        }

        .header-subtitle {
            font-size: 11px;
            color: #ffb300;
            font-weight: 500;
        }

        .canvas-area {
            flex: 1;
            min-height: 0;
            position: relative;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        .controls-strip {
            display: flex;
            gap: 8px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            gap: 6px;
            align-items: center;
            padding: 0 4px;
            border-right: 1px solid rgba(255, 255, 255, 0.15);
        }

        .control-group:last-child {
            border-right: none;
        }

        label {
            font-size: 11px;
            font-weight: 600;
            color: #ffb300;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        select, input[type="range"], input[type="number"] {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.4);
            color: #ffffff;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Inter', sans-serif;
            font-size: 12px;
        }

        select:hover, input[type="range"]:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 193, 7, 0.7);
        }

        select:focus, input[type="range"]:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.2);
            border-color: #ffc107;
        }

        button {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.2) 0%, rgba(255, 193, 7, 0.1) 100%);
            border: 1px solid rgba(255, 193, 7, 0.5);
            color: #ffc107;
            padding: 4px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.2s ease;
        }

        button:hover {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.3) 0%, rgba(255, 193, 7, 0.2) 100%);
            border-color: #ffc107;
            box-shadow: 0 0 12px rgba(255, 193, 7, 0.3);
        }

        button:active {
            transform: scale(0.98);
        }

        button.active {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.5) 0%, rgba(255, 193, 7, 0.3) 100%);
            border-color: #ffc107;
            box-shadow: 0 0 16px rgba(255, 193, 7, 0.5);
        }

        input[type="range"] {
            width: 120px;
            height: 4px;
            padding: 0;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #ffc107;
            cursor: pointer;
            box-shadow: 0 0 8px rgba(255, 193, 7, 0.6);
        }

        input[type="range"]::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #ffc107;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 8px rgba(255, 193, 7, 0.6);
        }

        .info-panel {
            position: absolute;
            bottom: 8px;
            right: 8px;
            max-width: 220px;
            padding: 8px 10px;
            background: rgba(30, 20, 30, 0.95);
            border: 1px solid rgba(255, 193, 7, 0.4);
            border-radius: 6px;
            font-size: 11px;
            line-height: 1.4;
            backdrop-filter: blur(10px);
        }

        .info-panel h3 {
            font-size: 12px;
            font-weight: 700;
            color: #ffc107;
            margin-bottom: 4px;
        }

        .info-panel p {
            margin: 2px 0;
            color: rgba(255, 255, 255, 0.85);
        }

        .info-label {
            font-weight: 600;
            color: #ffb300;
            display: inline-block;
            width: 50px;
        }

        @media (max-width: 900px) {
            .control-group {
                border-right: none;
            }

            .controls-strip {
                flex-direction: column;
                gap: 6px;
            }
        }

        /* Slider track styling */
        input[type="range"]::-webkit-slider-runnable-track {
            background: rgba(255, 193, 7, 0.2);
            height: 4px;
            border-radius: 2px;
        }

        input[type="range"]::-moz-range-track {
            background: rgba(255, 193, 7, 0.2);
            height: 4px;
            border-radius: 2px;
            border: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>Entdeckungsreisen und Kolonialismus</h1>
                <div class="header-subtitle">Altersgerecht Simulation der Entdeckungsreisen (15./16. Jahrhundert)</div>
            </div>
        </div>

        <div class="canvas-area">
            <canvas id="explorationCanvas"></canvas>
            <div class="info-panel">
                <h3 id="infoName">Wählen Sie einen Entdecker</h3>
                <p><span class="info-label">Jahr:</span> <span id="infoYear">-</span></p>
                <p><span class="info-label">Sponsor:</span> <span id="infoSponsor">-</span></p>
                <p><span class="info-label">Ziel:</span> <span id="infoGoal">-</span></p>
                <p><span class="info-label">Ergebnis:</span> <span id="infoResult">-</span></p>
            </div>
        </div>

        <div class="controls-strip">
            <div class="control-group">
                <label for="explorerSelect">Entdecker:</label>
                <select id="explorerSelect">
                    <option value="">-- Wählen Sie einen Entdecker --</option>
                    <option value="columbus">Christoph Kolumbus (1492)</option>
                    <option value="gama">Vasco da Gama (1498)</option>
                    <option value="magellan">Ferdinand Magellan (1519-1522)</option>
                    <option value="zhenghe">Zheng He (1405-1433)</option>
                    <option value="cook">James Cook (1768-1771)</option>
                </select>
            </div>

            <div class="control-group">
                <button id="playBtn">▶ Abspielen</button>
                <button id="pauseBtn">⏸ Pause</button>
                <button id="resetBtn">↻ Zurücksetzen</button>
            </div>

            <div class="control-group">
                <label for="progressSlider">Route:</label>
                <input type="range" id="progressSlider" min="0" max="100" value="0">
                <span id="progressText" style="font-size: 10px; color: #ffb300;">0%</span>
            </div>

            <div class="control-group">
                <label for="speedSlider">Geschwindigkeit:</label>
                <input type="range" id="speedSlider" min="0.5" max="2" step="0.5" value="1">
            </div>
        </div>
    </div>

    <script>
        // Explorer Data
        const explorers = {
            columbus: {
                name: 'Christoph Kolumbus',
                year: '1492',
                sponsor: 'Spanien',
                goal: 'Route zu den Indies finden',
                result: 'Entdeckung der Neuen Welt (Amerika)',
                color: '#4A90E2',
                points: [
                    { lat: 37, lon: -5 },    // Palos, Spanien
                    { lat: 35, lon: -15 },   // Atlantik
                    { lat: 25, lon: -40 },   // Atlantik
                    { lat: 20, lon: -65 },   // Karibik
                    { lat: 18, lon: -73 }    // Hispaniola
                ]
            },
            gama: {
                name: 'Vasco da Gama',
                year: '1498',
                sponsor: 'Portugal',
                goal: 'Seeweg zu indischen Gewürzen finden',
                result: 'Erster Seeweg nach Indien etabliert',
                color: '#2ECC71',
                points: [
                    { lat: 39, lon: -8 },    // Lissabon
                    { lat: 30, lon: 10 },    // Mittelmeer
                    { lat: 8, lon: 40 },     // Rotes Meer
                    { lat: -8, lon: 35 },    // Afrika-Kap
                    { lat: -28, lon: 32 },   // Kap der Guten Hoffnung
                    { lat: -18, lon: 36 },   // Ostafrika
                    { lat: 2, lon: 50 },     // Arabisches Meer
                    { lat: 10, lon: 75 }     // Indien (Calicut)
                ]
            },
            magellan: {
                name: 'Ferdinand Magellan',
                year: '1519-1522',
                sponsor: 'Spanien',
                goal: 'Westliche Route zu den Molukken',
                result: 'Erste Weltumsegelung (unter Elcano)',
                color: '#E74C3C',
                points: [
                    { lat: 37, lon: -8 },    // Sevilla/Spanien
                    { lat: 20, lon: -35 },   // Atlantik
                    { lat: -20, lon: -45 },  // Brasilien
                    { lat: -52, lon: -70 },  // Magellanstraße
                    { lat: -30, lon: -70 },  // Pazifik
                    { lat: 10, lon: 140 },   // Pazifik
                    { lat: 9, lon: 123 },    // Philippinen
                    { lat: 8, lon: 125 },    // Molukken
                    { lat: 5, lon: 120 },    // Rückweg
                    { lat: 15, lon: 60 },    // Indischer Ozean
                    { lat: 20, lon: 40 },    // Rotes Meer
                    { lat: 36, lon: 0 }      // Zurück nach Spanien
                ]
            },
            zhenghe: {
                name: 'Zheng He',
                year: '1405-1433',
                sponsor: 'China (Ming-Dynastie)',
                goal: 'Tributmissionen und Handel',
                result: 'Machtdemonstration chinesischer Macht',
                color: '#F1C40F',
                points: [
                    { lat: 32, lon: 118 },   // China (Nanjing)
                    { lat: 20, lon: 110 },   // Südchina
                    { lat: 8, lon: 105 },    // Südchinesisches Meer
                    { lat: 5, lon: 95 },     // Malakkastraße
                    { lat: 2, lon: 85 },     // Indischer Ozean
                    { lat: -2, lon: 75 },    // Indischer Ozean
                    { lat: -8, lon: 40 },    // Ostafrika
                    { lat: -5, lon: 37 },    // Afrikanische Küste
                    { lat: 0, lon: 35 },     // Rückweg
                    { lat: 8, lon: 45 },     // Arabisches Meer
                    { lat: 15, lon: 60 }     // Arabischer Golf
                ]
            },
            cook: {
                name: 'James Cook',
                year: '1768-1771',
                sponsor: 'Großbritannien',
                goal: 'Pazifische Südseemeere erforschen',
                result: 'Kartographierung der Pazifischen Inseln',
                color: '#1ABC9C',
                points: [
                    { lat: 51, lon: -2 },    // Plymouth, England
                    { lat: 35, lon: -20 },   // Atlantik
                    { lat: 0, lon: -30 },    // Äquator Atlantik
                    { lat: -25, lon: -40 },  // Brasilien
                    { lat: -55, lon: -70 },  // Südamerika
                    { lat: -65, lon: -100 }, // Süd-Pazifik
                    { lat: -50, lon: -120 }, // Pazifik
                    { lat: -40, lon: -150 }, // Pazifik
                    { lat: -25, lon: -160 }, // Poly Südsee
                    { lat: -15, lon: 180 },  // Pazifik
                    { lat: 0, lon: 170 },    // Pazifik
                    { lat: 15, lon: 150 },   // Pazifik
                    { lat: 25, lon: 130 }    // Zurück Australien
                ]
            }
        };

        // Canvas setup
        const canvas = document.getElementById('explorationCanvas');
        const ctx = canvas.getContext('2d');
        let animationId = null;
        let currentExplorer = null;
        let progress = 0; // 0-100
        let isPlaying = false;
        let speed = 1;
        let lastFrameTime = Date.now();

        function setCanvasSize() {
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';
        }

        function drawContinents(width, height) {
            ctx.fillStyle = 'rgba(255, 255, 255, 0.08)';
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.lineWidth = 1;

            // Normalize coordinates to canvas (simple Mercator-like)
            const normalize = (lat, lon) => {
                const x = (lon + 180) / 360 * width;
                const y = (90 - lat) / 180 * height;
                return { x, y };
            };

            // Europe
            const euPoints = [
                { lat: 60, lon: -10 }, { lat: 55, lon: 0 }, { lat: 50, lon: 10 },
                { lat: 45, lon: 15 }, { lat: 40, lon: 15 }, { lat: 38, lon: 0 },
                { lat: 42, lon: -5 }, { lat: 50, lon: -8 }, { lat: 60, lon: -10 }
            ];
            ctx.beginPath();
            euPoints.forEach((p, i) => {
                const norm = normalize(p.lat, p.lon);
                if (i === 0) ctx.moveTo(norm.x, norm.y);
                else ctx.lineTo(norm.x, norm.y);
            });
            ctx.fill();
            ctx.stroke();

            // Africa
            const afPoints = [
                { lat: 35, lon: 10 }, { lat: 30, lon: 20 }, { lat: 20, lon: 30 },
                { lat: 10, lon: 35 }, { lat: 0, lon: 35 }, { lat: -10, lon: 35 },
                { lat: -20, lon: 32 }, { lat: -30, lon: 30 }, { lat: -35, lon: 20 },
                { lat: -34, lon: 10 }, { lat: -30, lon: 5 }, { lat: -20, lon: 5 },
                { lat: -10, lon: 10 }, { lat: 0, lon: 15 }, { lat: 10, lon: 20 },
                { lat: 20, lon: 15 }, { lat: 30, lon: 15 }, { lat: 35, lon: 10 }
            ];
            ctx.beginPath();
            afPoints.forEach((p, i) => {
                const norm = normalize(p.lat, p.lon);
                if (i === 0) ctx.moveTo(norm.x, norm.y);
                else ctx.lineTo(norm.x, norm.y);
            });
            ctx.fill();
            ctx.stroke();

            // Asia
            const asPoints = [
                { lat: 60, lon: 60 }, { lat: 55, lon: 100 }, { lat: 50, lon: 120 },
                { lat: 45, lon: 130 }, { lat: 40, lon: 140 }, { lat: 35, lon: 150 },
                { lat: 25, lon: 155 }, { lat: 15, lon: 150 }, { lat: 5, lon: 140 },
                { lat: 0, lon: 120 }, { lat: -5, lon: 100 }, { lat: 0, lon: 80 },
                { lat: 10, lon: 70 }, { lat: 20, lon: 60 }, { lat: 30, lon: 50 },
                { lat: 40, lon: 40 }, { lat: 50, lon: 30 }, { lat: 60, lon: 60 }
            ];
            ctx.beginPath();
            asPoints.forEach((p, i) => {
                const norm = normalize(p.lat, p.lon);
                if (i === 0) ctx.moveTo(norm.x, norm.y);
                else ctx.lineTo(norm.x, norm.y);
            });
            ctx.fill();
            ctx.stroke();

            // Americas
            const amPoints = [
                { lat: 60, lon: -90 }, { lat: 50, lon: -100 }, { lat: 40, lon: -95 },
                { lat: 30, lon: -100 }, { lat: 20, lon: -95 }, { lat: 10, lon: -80 },
                { lat: 0, lon: -75 }, { lat: -10, lon: -65 }, { lat: -20, lon: -55 },
                { lat: -30, lon: -60 }, { lat: -40, lon: -65 }, { lat: -50, lon: -75 },
                { lat: -55, lon: -70 }, { lat: -50, lon: -65 }, { lat: -40, lon: -60 },
                { lat: -30, lon: -55 }, { lat: -20, lon: -50 }, { lat: -10, lon: -50 },
                { lat: 0, lon: -55 }, { lat: 10, lon: -60 }, { lat: 20, lon: -80 },
                { lat: 30, lon: -95 }, { lat: 40, lon: -90 }, { lat: 50, lon: -100 },
                { lat: 60, lon: -90 }
            ];
            ctx.beginPath();
            amPoints.forEach((p, i) => {
                const norm = normalize(p.lat, p.lon);
                if (i === 0) ctx.moveTo(norm.x, norm.y);
                else ctx.lineTo(norm.x, norm.y);
            });
            ctx.fill();
            ctx.stroke();
        }

        function drawRoute(explorer, width, height) {
            if (!explorer) return;

            const normalize = (lat, lon) => {
                const x = (lon + 180) / 360 * width;
                const y = (90 - lat) / 180 * height;
                return { x, y };
            };

            const points = explorer.points;
            const progressIndex = (progress / 100) * (points.length - 1);
            const currentIndex = Math.floor(progressIndex);
            const segmentProgress = progressIndex - currentIndex;

            // Draw full route in faded color
            ctx.strokeStyle = explorer.color;
            ctx.globalAlpha = 0.3;
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 3]);
            ctx.beginPath();
            points.forEach((p, i) => {
                const norm = normalize(p.lat, p.lon);
                if (i === 0) ctx.moveTo(norm.x, norm.y);
                else ctx.lineTo(norm.x, norm.y);
            });
            ctx.stroke();
            ctx.setLineDash([]);

            // Draw completed route in bright color
            ctx.globalAlpha = 1;
            ctx.strokeStyle = explorer.color;
            ctx.lineWidth = 3;
            ctx.beginPath();
            for (let i = 0; i < currentIndex && i < points.length; i++) {
                const norm = normalize(points[i].lat, points[i].lon);
                if (i === 0) ctx.moveTo(norm.x, norm.y);
                else ctx.lineTo(norm.x, norm.y);
            }
            if (currentIndex < points.length) {
                const norm1 = normalize(points[currentIndex].lat, points[currentIndex].lon);
                if (currentIndex === 0) ctx.moveTo(norm1.x, norm1.y);
                else ctx.lineTo(norm1.x, norm1.y);

                // Draw partial segment
                if (currentIndex + 1 < points.length) {
                    const norm2 = normalize(points[currentIndex + 1].lat, points[currentIndex + 1].lon);
                    const interpX = norm1.x + (norm2.x - norm1.x) * segmentProgress;
                    const interpY = norm1.y + (norm2.y - norm1.y) * segmentProgress;
                    ctx.lineTo(interpX, interpY);
                }
            }
            ctx.stroke();

            // Draw ship at current position
            if (currentIndex < points.length) {
                let shipX, shipY;
                if (currentIndex + 1 < points.length) {
                    const norm1 = normalize(points[currentIndex].lat, points[currentIndex].lon);
                    const norm2 = normalize(points[currentIndex + 1].lat, points[currentIndex + 1].lon);
                    shipX = norm1.x + (norm2.x - norm1.x) * segmentProgress;
                    shipY = norm1.y + (norm2.y - norm1.y) * segmentProgress;
                } else {
                    const norm = normalize(points[currentIndex].lat, points[currentIndex].lon);
                    shipX = norm.x;
                    shipY = norm.y;
                }

                // Calculate heading
                let heading = 0;
                if (currentIndex + 1 < points.length) {
                    const norm1 = normalize(points[currentIndex].lat, points[currentIndex].lon);
                    const norm2 = normalize(points[currentIndex + 1].lat, points[currentIndex + 1].lon);
                    heading = Math.atan2(norm2.y - norm1.y, norm2.x - norm1.x);
                }

                // Draw ship (triangle)
                ctx.save();
                ctx.translate(shipX, shipY);
                ctx.rotate(heading);
                ctx.fillStyle = explorer.color;
                ctx.beginPath();
                ctx.moveTo(8, 0);
                ctx.lineTo(-5, -5);
                ctx.lineTo(-3, 0);
                ctx.lineTo(-5, 5);
                ctx.closePath();
                ctx.fill();
                ctx.restore();

                // Draw ship glow
                ctx.fillStyle = explorer.color;
                ctx.globalAlpha = 0.4;
                ctx.beginPath();
                ctx.arc(shipX, shipY, 12, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;
            }
        }

        function drawWaypoints(explorer, width, height) {
            if (!explorer) return;

            const normalize = (lat, lon) => {
                const x = (lon + 180) / 360 * width;
                const y = (90 - lat) / 180 * height;
                return { x, y };
            };

            const points = explorer.points;
            const progressIndex = (progress / 100) * (points.length - 1);
            const currentIndex = Math.floor(progressIndex);

            // Draw waypoints up to current position
            ctx.fillStyle = explorer.color;
            ctx.globalAlpha = 0.6;
            points.forEach((p, i) => {
                if (i <= currentIndex) {
                    const norm = normalize(p.lat, p.lon);
                    ctx.beginPath();
                    ctx.arc(norm.x, norm.y, 3, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
            ctx.globalAlpha = 1;
        }

        function animate() {
            const width = canvas.width / (window.devicePixelRatio || 1);
            const height = canvas.height / (window.devicePixelRatio || 1);

            // Clear canvas
            ctx.fillStyle = 'rgba(26, 10, 10, 0.1)';
            ctx.fillRect(0, 0, width, height);

            // Draw continents
            drawContinents(width, height);

            // Draw current route
            if (currentExplorer) {
                drawRoute(currentExplorer, width, height);
                drawWaypoints(currentExplorer, width, height);
            }

            // Update animation
            if (isPlaying && currentExplorer) {
                const now = Date.now();
                const deltaTime = now - lastFrameTime;
                lastFrameTime = now;
                progress = Math.min(100, progress + (deltaTime / 1000) * 20 * speed);
                document.getElementById('progressSlider').value = progress;
                document.getElementById('progressText').textContent = Math.round(progress) + '%';

                if (progress >= 100) {
                    isPlaying = false;
                    document.getElementById('playBtn').classList.remove('active');
                    document.getElementById('pauseBtn').classList.remove('active');
                }
            }

            animationId = requestAnimationFrame(animate);
        }

        function selectExplorer(name) {
            currentExplorer = explorers[name] || null;
            progress = 0;
            isPlaying = false;
            lastFrameTime = Date.now();

            document.getElementById('progressSlider').value = 0;
            document.getElementById('progressText').textContent = '0%';
            document.getElementById('playBtn').classList.remove('active');
            document.getElementById('pauseBtn').classList.remove('active');

            if (currentExplorer) {
                document.getElementById('infoName').textContent = currentExplorer.name;
                document.getElementById('infoYear').textContent = currentExplorer.year;
                document.getElementById('infoSponsor').textContent = currentExplorer.sponsor;
                document.getElementById('infoGoal').textContent = currentExplorer.goal;
                document.getElementById('infoResult').textContent = currentExplorer.result;
            } else {
                document.getElementById('infoName').textContent = 'Wählen Sie einen Entdecker';
                document.getElementById('infoYear').textContent = '-';
                document.getElementById('infoSponsor').textContent = '-';
                document.getElementById('infoGoal').textContent = '-';
                document.getElementById('infoResult').textContent = '-';
            }
        }

        // Event listeners
        document.getElementById('explorerSelect').addEventListener('change', (e) => {
            selectExplorer(e.target.value);
        });

        document.getElementById('playBtn').addEventListener('click', () => {
            if (!currentExplorer) return;
            isPlaying = true;
            lastFrameTime = Date.now();
            document.getElementById('playBtn').classList.add('active');
            document.getElementById('pauseBtn').classList.remove('active');
        });

        document.getElementById('pauseBtn').addEventListener('click', () => {
            isPlaying = false;
            document.getElementById('playBtn').classList.remove('active');
            document.getElementById('pauseBtn').classList.add('active');
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            progress = 0;
            isPlaying = false;
            lastFrameTime = Date.now();
            document.getElementById('progressSlider').value = 0;
            document.getElementById('progressText').textContent = '0%';
            document.getElementById('playBtn').classList.remove('active');
            document.getElementById('pauseBtn').classList.remove('active');
        });

        document.getElementById('progressSlider').addEventListener('input', (e) => {
            progress = parseFloat(e.target.value);
            document.getElementById('progressText').textContent = Math.round(progress) + '%';
            isPlaying = false;
            document.getElementById('playBtn').classList.remove('active');
            document.getElementById('pauseBtn').classList.remove('active');
        });

        document.getElementById('speedSlider').addEventListener('input', (e) => {
            speed = parseFloat(e.target.value);
        });

        window.addEventListener('resize', () => {
            setCanvasSize();
        });

        // Initialize
        setCanvasSize();
        setTimeout(() => {
            animate();
        }, 50);
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√ñsterreichisches Parlament - Gesetzgebungsprozess</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1a0a0a 0%, #3d1020 50%, #5c1030 100%);
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        .container {
            height: 100vh;
            display: grid;
            grid-template-columns: 1fr 280px;
            gap: 12px;
            padding: 12px;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-height: 0;
        }

        .header {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 700;
            color: #ffc107;
        }

        .header-subtitle {
            font-size: 12px;
            color: #b0b0b0;
        }

        .mode-toggle {
            display: flex;
            gap: 6px;
            background: rgba(255, 193, 7, 0.05);
            padding: 4px;
            border-radius: 6px;
            border: 1px solid rgba(255, 193, 7, 0.2);
        }

        .mode-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            background: transparent;
            color: #b0b0b0;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn.active {
            background: #ffc107;
            color: #1a0a0a;
        }

        .canvas-container {
            flex: 1;
            background: rgba(255, 193, 7, 0.02);
            border: 1px solid rgba(255, 193, 7, 0.2);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        .controls {
            display: flex;
            gap: 8px;
            background: rgba(255, 193, 7, 0.08);
            border: 1px solid rgba(255, 193, 7, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            padding: 12px;
        }

        .controls-left {
            display: flex;
            gap: 8px;
            flex: 1;
        }

        .controls-right {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .btn {
            padding: 8px 16px;
            border: 1px solid rgba(255, 193, 7, 0.3);
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        .btn:hover {
            background: rgba(255, 193, 7, 0.2);
            border-color: rgba(255, 193, 7, 0.5);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none;
        }

        .btn.primary {
            background: #ffc107;
            color: #1a0a0a;
            border-color: #ffc107;
        }

        .btn.primary:hover {
            background: #ffeb3b;
            border-color: #ffeb3b;
        }

        .play-btn {
            width: 36px;
            height: 36px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-height: 0;
        }

        .info-panel {
            background: rgba(255, 193, 7, 0.08);
            border: 1px solid rgba(255, 193, 7, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            padding: 12px;
            flex: 1;
            overflow-y: auto;
            min-height: 200px;
        }

        .info-title {
            font-size: 13px;
            font-weight: 700;
            color: #ffc107;
            margin-bottom: 8px;
        }

        .info-content {
            font-size: 11px;
            line-height: 1.5;
            color: #d0d0d0;
        }

        .info-content p {
            margin-bottom: 6px;
        }

        .step-list {
            background: rgba(255, 193, 7, 0.08);
            border: 1px solid rgba(255, 193, 7, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            overflow-y: auto;
            max-height: 200px;
        }

        .step-item {
            padding: 8px 12px;
            border-bottom: 1px solid rgba(255, 193, 7, 0.1);
            font-size: 11px;
            color: #b0b0b0;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .step-item:last-child {
            border-bottom: none;
        }

        .step-item:hover {
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
        }

        .step-item.active {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            font-weight: 600;
        }

        .step-item.completed {
            color: #4caf50;
        }

        .step-item.completed::before {
            content: '‚úì';
            color: #4caf50;
            font-weight: 700;
        }

        .step-item.pending::before {
            content: '‚óã';
            color: #666;
        }

        .step-item.active::before {
            content: '‚óè';
            color: #ffc107;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(255, 193, 7, 0.05);
            padding: 6px 10px;
            border-radius: 6px;
            border: 1px solid rgba(255, 193, 7, 0.2);
        }

        .speed-control label {
            font-size: 10px;
            color: #b0b0b0;
        }

        .speed-control input {
            width: 60px;
            height: 20px;
        }

        input[type="range"] {
            cursor: pointer;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 193, 7, 0.05);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 193, 7, 0.3);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 193, 7, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-content">
            <div class="header">
                <div>
                    <div class="header h1">√ñsterreichisches Parlament</div>
                    <div class="header-subtitle">Gesetzgebungsprozess (Bundesgesetzgebung)</div>
                </div>
                <div class="mode-toggle">
                    <button class="mode-btn active" data-mode="federal">Bund</button>
                    <button class="mode-btn" data-mode="state">L√§nder</button>
                </div>
            </div>

            <div class="canvas-container">
                <canvas id="mainCanvas"></canvas>
            </div>

            <div class="controls">
                <div class="controls-left">
                    <button class="btn" id="prevBtn">‚óÄ Vorheriger Schritt</button>
                    <button class="btn primary play-btn" id="playBtn">‚ñ∂</button>
                    <button class="btn" id="nextBtn">N√§chster Schritt ‚ñ∂</button>
                </div>
                <div class="controls-right">
                    <div class="speed-control">
                        <label>Geschwindigkeit:</label>
                        <input type="range" id="speedSlider" min="0.5" max="3" step="0.5" value="1">
                    </div>
                </div>
            </div>
        </div>

        <div class="sidebar">
            <div class="info-panel">
                <div class="info-title" id="infoTitle">Gesetzesinitiative</div>
                <div class="info-content" id="infoContent">
                    <p>Die Gesetzesinitiative ist der erste Schritt. Gesetze k√∂nnen vorgeschlagen werden durch:</p>
                    <p>‚Ä¢ Regierungsvorlage (Ministerium)</p>
                    <p>‚Ä¢ Initiativantrag (Parlamentarier)</p>
                    <p>‚Ä¢ Volksbegehren (100.000 B√ºrger)</p>
                </div>
            </div>

            <div class="step-list" id="stepList"></div>
        </div>
    </div>

    <script>
        // ==================== Configuration ====================
        const config = {
            federal: {
                title: '√ñsterreichisches Parlament - Bundesgesetzgebung',
                steps: [
                    {
                        id: 'initiative',
                        name: 'Gesetzesinitiative',
                        icon: 'üìã',
                        info: 'Die Gesetzesinitiative ist der erste Schritt. Gesetze k√∂nnen vorgeschlagen werden durch:\n\n‚Ä¢ Regierungsvorlage (Ministerium)\n‚Ä¢ Initiativantrag (Parlamentarier)\n‚Ä¢ Volksbegehren (100.000 B√ºrger)',
                        details: 'In √ñsterreich gibt es drei Arten von Gesetzesvorhaben: Regierungsvorlagen werden vom Ministerrat beschlossen, Initiativantr√§ge werden von mindestens 5 Abgeordneten eingereicht, und Volksbegehrensgesetze ben√∂tigen 100.000 Unterschriften.'
                    },
                    {
                        id: 'committee',
                        name: 'Ausschussberatung',
                        icon: 'üë•',
                        info: 'Das Gesetzesvorhaben wird in den zust√§ndigen Aussch√ºssen des Nationalrates diskutiert.\n\nAussch√ºsse:\n‚Ä¢ Analyse und Beratung\n‚Ä¢ Experten h√∂ren\n‚Ä¢ Erste √Ñnderungen',
                        details: 'Die Aussch√ºsse sind spezialisiert auf verschiedene Bereiche wie Wirtschaft, Bildung, Gesundheit etc. Hier wird das Vorhaben intensiv diskutiert.'
                    },
                    {
                        id: 'plenum',
                        name: 'Plenum Nationalrat',
                        icon: 'üèõÔ∏è',
                        info: 'Debatte und Abstimmung im Plenum des Nationalrates (183 Abgeordnete).\n\nAblauf:\n‚Ä¢ Erste Lesung (Allgemeine Debatte)\n‚Ä¢ Zweite Lesung (Detailberatung)\n‚Ä¢ Dritte Lesung (Endabstimmung)',
                        details: 'Der Nationalrat ist das Unterhaus und hat 183 Mitglieder aus verschiedenen Parteien. Eine absolute Mehrheit (92 Stimmen) ist erforderlich.'
                    },
                    {
                        id: 'bundesrat',
                        name: 'Bundesrat',
                        icon: '‚öñÔ∏è',
                        info: 'Der Bundesrat (61 Mitglieder aus den L√§ndern) kann das Gesetz √ºberpr√ºfen.\n\nM√∂glichkeiten:\n‚Ä¢ Zustimmung\n‚Ä¢ Tolerierung\n‚Ä¢ Veto (f√ºr 8 Wochen)',
                        details: 'Der Bundesrat hat Vertreter aller neun Bundesl√§nder. W√§hrend der 8-Wochen-Frist kann der Nationalrat das Veto mit absoluter Mehrheit aufheben.'
                    },
                    {
                        id: 'president',
                        name: 'Bundespr√§sident',
                        icon: 'üë®‚Äç‚öñÔ∏è',
                        info: 'Der Bundespr√§sident unterzeichnet das Gesetz.\n\nZust√§ndigkeiten:\n‚Ä¢ Formale √úberpr√ºfung\n‚Ä¢ Unterzeichnung\n‚Ä¢ Evtl. Richtlinienkompetenz',
                        details: 'Der Bundespr√§sident hat die Aufgabe, die Verfassungsm√§√üigkeit zu √ºberpr√ºfen, kann aber bei Verfassungsverletzungen sein Veto einlegen.'
                    },
                    {
                        id: 'publication',
                        name: 'Kundmachung',
                        icon: 'üì∞',
                        info: 'Das Gesetz wird im Bundesgesetzblatt (BGBl) ver√∂ffentlicht.\n\nDanach:\n‚Ä¢ Offiziell g√ºltig\n‚Ä¢ Alle sind verpflichtet zu beachten\n‚Ä¢ Tritt meist mit Verz√∂gerung in Kraft',
                        details: 'Die Kundmachung im BGBl ist notwendig, damit das Gesetz allgemein bekannt und verbindlich wird. Oft tritt es erst zu einem sp√§ter festgelegten Zeitpunkt in Kraft.'
                    }
                ]
            },
            state: {
                title: '√ñsterreichisches Parlament - Landesgesetzgebung',
                steps: [
                    {
                        id: 'state_initiative',
                        name: 'Landesgesetzinitiative',
                        icon: 'üìã',
                        info: 'Die Initiative erfolgt auf Landesebene.\n\nQuellen:\n‚Ä¢ Landesregierung\n‚Ä¢ Landtag-Abgeordnete\n‚Ä¢ Volksbegehrensgesetze (50.000 Unterschriften)',
                        details: 'Gesetze auf Landesebene werden √§hnlich eingebracht, ben√∂tigen aber weniger Unterschriften f√ºr Volksbegehrensgesetze.'
                    },
                    {
                        id: 'state_committee',
                        name: 'Landtag-Aussch√ºsse',
                        icon: 'üë•',
                        info: 'Beratung in den Aussch√ºssen des Landtages.\n\nProcess:\n‚Ä¢ Spezialisierte Aussch√ºsse\n‚Ä¢ √ñffentliche Anh√∂rungen\n‚Ä¢ Regierungsvertreter',
                        details: 'Jedes Bundesland hat seinen eigenen Landtag mit verschiedenen Gr√∂√üen und Ausschussstrukturen.'
                    },
                    {
                        id: 'state_plenum',
                        name: 'Landtag-Plenum',
                        icon: 'üèõÔ∏è',
                        info: 'Abstimmung im Plenum des Landtages.\n\nRegeln:\n‚Ä¢ Unterschiedliche Gr√∂√üen pro Land\n‚Ä¢ Absolute Mehrheit erforderlich\n‚Ä¢ Regionale Besonderheiten',
                        details: 'Die Gr√∂√üe der Landt√§ge variiert von etwa 30-100 Abgeordneten je nach Bundesland.'
                    },
                    {
                        id: 'state_governor',
                        name: 'Landeshauptmann',
                        icon: 'üë®‚Äç‚öñÔ∏è',
                        info: 'Der Landeshauptmann unterzeichnet.\n\nAufgaben:\n‚Ä¢ √úberpr√ºfung\n‚Ä¢ Unterzeichnung\n‚Ä¢ Vetom√∂glichkeit',
                        details: 'Der Landeshauptmann ist das Staatsoberhaupt des Bundeslandes und unterzeichnet die Landesgesetze.'
                    },
                    {
                        id: 'state_publication',
                        name: 'Ver√∂ffentlichung',
                        icon: 'üì∞',
                        info: 'Ver√∂ffentlichung im Landesgesetzblatt.\n\nWirkung:\n‚Ä¢ Tritt in Kraft\n‚Ä¢ F√ºr das ganze Land g√ºltig\n‚Ä¢ Bindend f√ºr alle',
                        details: 'Das Landesgesetz wird im jeweiligen Landesgesetzblatt (LGBl) ver√∂ffentlicht und tritt damit in Kraft.'
                    }
                ]
            }
        };

        // ==================== State Management ====================
        let state = {
            currentMode: 'federal',
            currentStep: 0,
            isPlaying: false,
            playSpeed: 1,
            particles: []
        };

        // ==================== Canvas Setup ====================
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width * window.devicePixelRatio;
            canvas.height = rect.height * window.devicePixelRatio;
            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
        }

        window.addEventListener('resize', () => {
            resizeCanvas();
            draw();
        });

        resizeCanvas();

        // ==================== Drawing Functions ====================
        const colors = {
            gold: '#ffc107',
            darkBg: '#1a0a0a',
            text: '#ffffff',
            light: '#d0d0d0',
            completed: '#4caf50',
            pending: '#666666',
            ovp: '#009ed9',
            spo: '#ed2939',
            fpo: '#003da5',
            greens: '#10af41',
            neos: '#e61e8d',
            hemicycleWall: '#2a2a2a'
        };

        class Particle {
            constructor(startX, startY, endX, endY) {
                this.startX = startX;
                this.startY = startY;
                this.endX = endX;
                this.endY = endY;
                this.progress = 0;
                this.speed = 0.01 + Math.random() * 0.02;
                this.size = 2 + Math.random() * 2;
            }

            update() {
                this.progress += this.speed;
                return this.progress < 1;
            }

            draw(ctx) {
                const x = this.startX + (this.endX - this.startX) * this.progress;
                const y = this.startY + (this.endY - this.startY) * this.progress;

                ctx.fillStyle = `rgba(255, 193, 7, ${1 - this.progress * 0.5})`;
                ctx.beginPath();
                ctx.arc(x, y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function drawRoundRect(ctx, x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.arcTo(x + width, y, x + width, y + radius, radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.arcTo(x + width, y + height, x + width - radius, y + height, radius);
            ctx.lineTo(x + radius, y + height);
            ctx.arcTo(x, y + height, x, y + height - radius, radius);
            ctx.lineTo(x, y + radius);
            ctx.arcTo(x, y, x + radius, y, radius);
            ctx.closePath();
        }

        function drawStep(ctx, x, y, width, height, stepIndex, isActive, isCompleted) {
            const steps = config[state.currentMode].steps;
            const step = steps[stepIndex];

            // Draw background
            if (isActive) {
                ctx.fillStyle = colors.gold;
                ctx.shadowColor = 'rgba(255, 193, 7, 0.5)';
                ctx.shadowBlur = 15;
            } else if (isCompleted) {
                ctx.fillStyle = colors.completed;
                ctx.shadowColor = 'rgba(76, 175, 80, 0.3)';
                ctx.shadowBlur = 10;
            } else {
                ctx.fillStyle = 'rgba(102, 102, 102, 0.3)';
                ctx.shadowColor = 'none';
                ctx.shadowBlur = 0;
            }

            drawRoundRect(ctx, x, y, width, height, 8);
            ctx.fill();

            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;

            // Draw border
            ctx.strokeStyle = isActive ? colors.gold : (isCompleted ? colors.completed : 'rgba(102, 102, 102, 0.5)');
            ctx.lineWidth = 2;
            ctx.stroke();

            // Draw icon and text
            ctx.fillStyle = isActive || isCompleted ? (isActive ? colors.darkBg : colors.text) : colors.light;
            ctx.font = 'bold 20px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(step.icon, x + width / 2, y + height / 3);

            // Draw step name
            ctx.font = 'bold 12px Inter';
            ctx.fillText(step.name, x + width / 2, y + 2 * height / 3);
        }

        function drawArrow(ctx, fromX, fromY, toX, toY) {
            const headlen = 15;
            const angle = Math.atan2(toY - fromY, toX - fromX);

            ctx.strokeStyle = 'rgba(255, 193, 7, 0.3)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.stroke();

            ctx.fillStyle = 'rgba(255, 193, 7, 0.3)';
            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headlen * Math.cos(angle - Math.PI / 6), toY - headlen * Math.sin(angle - Math.PI / 6));
            ctx.lineTo(toX - headlen * Math.cos(angle + Math.PI / 6), toY - headlen * Math.sin(angle + Math.PI / 6));
            ctx.closePath();
            ctx.fill();
        }

        function drawHemicycle(ctx, x, y, radius) {
            const parties = [
                { color: colors.ovp, seats: 71, name: '√ñVP' },
                { color: colors.spo, seats: 41, name: 'SP√ñ' },
                { color: colors.fpo, seats: 31, name: 'FP√ñ' },
                { color: colors.greens, seats: 26, name: 'Gr√ºne' },
                { color: colors.neos, seats: 15, name: 'NEOS' }
            ];

            // Draw hemicycle
            ctx.fillStyle = colors.hemicycleWall;
            ctx.beginPath();
            ctx.arc(x, y, radius, Math.PI, 0);
            ctx.fill();

            ctx.strokeStyle = colors.gold;
            ctx.lineWidth = 1;
            ctx.stroke();

            let currentAngle = Math.PI;
            const totalSeats = parties.reduce((sum, p) => sum + p.seats, 0);

            parties.forEach(party => {
                const angleSpan = (Math.PI * party.seats) / totalSeats;

                for (let i = 0; i < party.seats; i++) {
                    const angle = currentAngle + (angleSpan / party.seats) * i;
                    const seatX = x + Math.cos(angle) * (radius - 5);
                    const seatY = y + Math.sin(angle) * (radius - 5);

                    ctx.fillStyle = party.color;
                    ctx.beginPath();
                    ctx.arc(seatX, seatY, 2.5, 0, Math.PI * 2);
                    ctx.fill();
                }

                currentAngle += angleSpan;
            });
        }

        function draw() {
            ctx.fillStyle = 'rgba(26, 10, 10, 0.5)';
            ctx.fillRect(0, 0, canvas.width / window.devicePixelRatio, canvas.height / window.devicePixelRatio);

            const width = canvas.width / window.devicePixelRatio;
            const height = canvas.height / window.devicePixelRatio;
            const steps = config[state.currentMode].steps;
            const stepWidth = 90;
            const stepHeight = 90;

            // Calculate layout
            const totalWidth = steps.length * (stepWidth + 40) + 40;
            const startX = Math.max(20, (width - totalWidth) / 2);
            const startY = height / 2 - stepHeight / 2;

            // Draw steps and arrows
            for (let i = 0; i < steps.length; i++) {
                const x = startX + i * (stepWidth + 40);
                const y = startY;

                drawStep(ctx, x, y, stepWidth, stepHeight, i, i === state.currentStep, i < state.currentStep);

                if (i < steps.length - 1) {
                    const nextX = startX + (i + 1) * (stepWidth + 40);
                    drawArrow(ctx, x + stepWidth, y + stepHeight / 2, nextX, y + stepHeight / 2);
                }
            }

            // Special visualization for plenum step (step 2)
            if (state.currentStep === 2) {
                drawHemicycle(ctx, width / 2, startY - 70, 50);
            }

            // Update and draw particles
            state.particles = state.particles.filter(p => p.update());
            state.particles.forEach(p => p.draw(ctx));

            // Add new particles if currently between steps
            if (state.isPlaying && state.currentStep < steps.length - 1) {
                if (Math.random() < 0.3) {
                    const x = startX + state.currentStep * (stepWidth + 40) + stepWidth;
                    const y = startY + stepHeight / 2;
                    const nextX = startX + (state.currentStep + 1) * (stepWidth + 40);
                    const nextY = y;
                    state.particles.push(new Particle(x, y, nextX, nextY));
                }
            }
        }

        // ==================== Animation Loop ====================
        let lastAutoPlayTime = 0;
        const autoPlayInterval = 2000;

        function animate() {
            draw();

            if (state.isPlaying) {
                const now = Date.now();
                const interval = autoPlayInterval / state.playSpeed;
                if (now - lastAutoPlayTime > interval) {
                    if (state.currentStep < config[state.currentMode].steps.length - 1) {
                        state.currentStep++;
                        updateUI();
                    } else {
                        state.isPlaying = false;
                        updatePlayButton();
                    }
                    lastAutoPlayTime = now;
                }
            }

            requestAnimationFrame(animate);
        }

        animate();

        // ==================== UI Updates ====================
        function updateUI() {
            const steps = config[state.currentMode].steps;
            const currentStep = steps[state.currentStep];

            document.getElementById('infoTitle').textContent = currentStep.name;
            document.getElementById('infoContent').innerHTML = `<p>${currentStep.info.split('\n').join('</p><p>')}</p>`;

            document.querySelectorAll('.step-item').forEach((item, i) => {
                item.classList.remove('active', 'completed', 'pending');
                if (i === state.currentStep) {
                    item.classList.add('active');
                } else if (i < state.currentStep) {
                    item.classList.add('completed');
                } else {
                    item.classList.add('pending');
                }
            });

            updateButtonStates();
        }

        function updateButtonStates() {
            const steps = config[state.currentMode].steps;
            document.getElementById('prevBtn').disabled = state.currentStep === 0;
            document.getElementById('nextBtn').disabled = state.currentStep === steps.length - 1;
        }

        function updatePlayButton() {
            const btn = document.getElementById('playBtn');
            btn.textContent = state.isPlaying ? '‚è∏' : '‚ñ∂';
        }

        function populateStepList() {
            const steps = config[state.currentMode].steps;
            const list = document.getElementById('stepList');
            list.innerHTML = '';

            steps.forEach((step, i) => {
                const item = document.createElement('div');
                item.className = 'step-item';
                item.textContent = step.name;
                item.addEventListener('click', () => {
                    state.currentStep = i;
                    state.isPlaying = false;
                    updatePlayButton();
                    updateUI();
                });

                if (i === state.currentStep) {
                    item.classList.add('active');
                } else if (i < state.currentStep) {
                    item.classList.add('completed');
                } else {
                    item.classList.add('pending');
                }

                list.appendChild(item);
            });
        }

        // ==================== Event Listeners ====================
        document.getElementById('nextBtn').addEventListener('click', () => {
            const steps = config[state.currentMode].steps;
            if (state.currentStep < steps.length - 1) {
                state.currentStep++;
                updateUI();
            }
        });

        document.getElementById('prevBtn').addEventListener('click', () => {
            if (state.currentStep > 0) {
                state.currentStep--;
                updateUI();
            }
        });

        document.getElementById('playBtn').addEventListener('click', () => {
            state.isPlaying = !state.isPlaying;
            if (state.isPlaying && state.currentStep === config[state.currentMode].steps.length - 1) {
                state.currentStep = 0;
            }
            lastAutoPlayTime = Date.now();
            updatePlayButton();
        });

        document.getElementById('speedSlider').addEventListener('input', (e) => {
            state.playSpeed = parseFloat(e.target.value);
        });

        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                state.currentMode = btn.dataset.mode;
                state.currentStep = 0;
                state.isPlaying = false;

                // Update header subtitle
                const subtitle = document.querySelector('.header-subtitle');
                subtitle.textContent = config[state.currentMode].title.split(' - ')[1];

                populateStepList();
                updateUI();
                updatePlayButton();
            });
        });

        // ==================== Initial Setup ====================
        setTimeout(() => {
            populateStepList();
            updateUI();
            updatePlayButton();
        }, 50);
    </script>
</body>
</html>

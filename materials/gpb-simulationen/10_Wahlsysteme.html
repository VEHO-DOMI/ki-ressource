<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wahlsysteme im Vergleich</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1a0a0a 0%, #3d1020 50%, #5c1030 100%);
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            height: 100vh;
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 12px;
            padding: 12px;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-width: 0;
        }

        .title-bar {
            background: rgba(255, 193, 7, 0.15);
            border: 1px solid rgba(255, 193, 7, 0.3);
            backdrop-filter: blur(10px);
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 700;
            color: #ffc107;
            text-shadow: 0 0 10px rgba(255, 193, 7, 0.3);
        }

        .canvas-container {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 193, 7, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 0;
        }

        canvas {
            display: block;
            max-width: 100%;
            max-height: 100%;
        }

        .control-panel {
            width: 320px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 193, 7, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            overflow-y: auto;
            max-height: 100vh;
        }

        .control-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .section-title {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            color: #ffc107;
            letter-spacing: 1px;
        }

        select {
            width: 100%;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            color: #ffffff;
            border-radius: 4px;
            font-size: 13px;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        select:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: #ffc107;
        }

        select:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.2);
            border-color: #ffc107;
            box-shadow: 0 0 8px rgba(255, 193, 7, 0.3);
        }

        .party-control {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .party-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            font-weight: 600;
        }

        .party-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            display: inline-block;
            margin-right: 6px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .party-value {
            font-weight: 700;
            font-size: 11px;
            color: #ffc107;
        }

        input[type="range"] {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            -webkit-appearance: none;
            accent-color: #ffc107;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #ffc107;
            cursor: pointer;
            box-shadow: 0 0 8px rgba(255, 193, 7, 0.5);
            transition: all 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            width: 18px;
            height: 18px;
            box-shadow: 0 0 12px rgba(255, 193, 7, 0.7);
        }

        input[type="range"]::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #ffc107;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 8px rgba(255, 193, 7, 0.5);
            transition: all 0.2s ease;
        }

        input[type="range"]::-moz-range-thumb:hover {
            width: 18px;
            height: 18px;
            box-shadow: 0 0 12px rgba(255, 193, 7, 0.7);
        }

        .threshold-control {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .threshold-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            font-weight: 600;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
        }

        button {
            padding: 8px 12px;
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid rgba(255, 193, 7, 0.4);
            color: #ffc107;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        button:hover {
            background: rgba(255, 193, 7, 0.3);
            border-color: #ffc107;
            box-shadow: 0 0 8px rgba(255, 193, 7, 0.3);
        }

        button.active {
            background: rgba(255, 193, 7, 0.4);
            border-color: #ffc107;
            box-shadow: 0 0 12px rgba(255, 193, 7, 0.5);
        }

        .info-box {
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 4px;
            border: 1px solid rgba(255, 193, 7, 0.2);
            font-size: 11px;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.9);
            max-height: 120px;
            overflow-y: auto;
        }

        .info-title {
            font-weight: 700;
            color: #ffc107;
            margin-bottom: 4px;
            font-size: 10px;
            text-transform: uppercase;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 193, 7, 0.3);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 193, 7, 0.5);
        }

        .total-display {
            padding: 8px;
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 4px;
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: #ffc107;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-content">
            <div class="title-bar">
                ðŸ“Š Wahlsysteme im Vergleich
            </div>
            <div class="canvas-container">
                <canvas id="canvas"></canvas>
            </div>
        </div>

        <div class="control-panel">
            <div class="control-section">
                <div class="section-title">Szenario</div>
                <select id="scenarioSelect">
                    <option value="austria2024">Ã–sterreich 2024</option>
                    <option value="polarized">Polarisiert</option>
                    <option value="fragmented">Fragmentiert</option>
                    <option value="balanced">Ausgewogen</option>
                </select>
            </div>

            <div class="control-section">
                <div class="section-title">Stimmenverteilung</div>
                <div id="partyControls"></div>
                <div class="total-display" id="totalDisplay">Summe: 100%</div>
            </div>

            <div class="control-section">
                <div class="threshold-control">
                    <div class="threshold-label">
                        <span>4%-HÃ¼rde</span>
                        <span id="thresholdValue">4%</span>
                    </div>
                    <input type="range" id="thresholdSlider" min="0" max="10" value="4" step="0.5">
                </div>
            </div>

            <div class="control-section">
                <div class="button-group">
                    <button onclick="resetToDefaults()">ZurÃ¼cksetzen</button>
                    <button onclick="randomize()">ZufÃ¤llig</button>
                </div>
            </div>

            <div class="control-section">
                <div class="info-box" id="infoBox">
                    <div class="info-title">System-Info</div>
                    <div id="infoContent">WÃ¤hle ein Szenario oder passe die Stimmen an.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const parties = [
            { name: 'Partei A', color: '#00bcd4', abbr: 'PA' },
            { name: 'Partei B', color: '#f44336', abbr: 'PB' },
            { name: 'Partei C', color: '#2196f3', abbr: 'PC' },
            { name: 'Partei D', color: '#4caf50', abbr: 'PD' },
            { name: 'Partei E', color: '#e91e63', abbr: 'PE' }
        ];

        const scenarios = {
            austria2024: {
                name: 'Ã–sterreich 2024',
                votes: [30, 25, 20, 15, 10],
                info: 'Mehrheitslandschaft mit mehreren starken Parteien und fragmentiertem Mittelfeld.'
            },
            polarized: {
                name: 'Polarisiert',
                votes: [45, 40, 8, 4, 3],
                info: 'Zwei starke BlÃ¶cke mit schwachen Parteien. Zeigt Vor- und Nachteile der Systeme.'
            },
            fragmented: {
                name: 'Fragmentiert',
                votes: [18, 18, 18, 23, 23],
                info: 'Viele starke Parteien. Proportionales System bevorzugt, Mehrheitswahlrecht fÃ¼hrt zu Verzerrung.'
            },
            balanced: {
                name: 'Ausgewogen',
                votes: [20, 20, 20, 20, 20],
                info: 'GleichmÃ¤ÃŸige Verteilung. Jedes System funktioniert anders.'
            }
        };

        let state = {
            votes: [30, 25, 20, 15, 10],
            threshold: 4,
            totalSeats: 100
        };

        let animationState = {
            proportional: null,
            fptp: null,
            mixed: null,
            targetProportional: null,
            targetFptp: null,
            targetMixed: null,
            progress: 1
        };

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // Setup canvas
        function resizeCanvas() {
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';
        }

        window.addEventListener('resize', resizeCanvas);
        setTimeout(resizeCanvas, 50);

        // D'Hondt method for proportional representation
        function calculateProportional(votes, threshold, totalSeats) {
            const results = new Array(parties.length).fill(0);
            const filteredVotes = votes.map(v => v >= threshold ? v : 0);

            if (filteredVotes.reduce((a, b) => a + b, 0) === 0) {
                return results;
            }

            const quotients = [];
            for (let i = 0; i < parties.length; i++) {
                for (let j = 1; j <= totalSeats; j++) {
                    quotients.push({
                        party: i,
                        quotient: filteredVotes[i] / j,
                        divisor: j
                    });
                }
            }

            quotients.sort((a, b) => b.quotient - a.quotient);

            for (let i = 0; i < totalSeats; i++) {
                results[quotients[i].party]++;
            }

            return results;
        }

        // FPTP simulation with 20 districts
        function calculateFPTP(votes, totalSeats) {
            const results = new Array(parties.length).fill(0);
            const seatsPerDistrict = totalSeats / 20;
            const totalVotes = votes.reduce((a, b) => a + b, 0);

            for (let d = 0; d < 20; d++) {
                // Regional variation: parties get slight advantage in different districts
                const regional = votes.map((v, i) => {
                    let modifier = 1;
                    if (i === d % parties.length) {
                        modifier = 1.2;
                    }
                    if (i === (d + 1) % parties.length) {
                        modifier = 0.8;
                    }
                    return v * modifier;
                });

                for (let s = 0; s < seatsPerDistrict; s++) {
                    let maxVotes = -1;
                    let winner = 0;
                    for (let i = 0; i < parties.length; i++) {
                        const variance = Math.random() * 0.3;
                        const adjustedVotes = regional[i] * (1 + variance);
                        if (adjustedVotes > maxVotes) {
                            maxVotes = adjustedVotes;
                            winner = i;
                        }
                    }
                    results[winner]++;
                }
            }

            return results;
        }

        // Mixed system: 50 proportional, 50 FPTP
        function calculateMixed(votes, threshold, totalSeats) {
            const proportionalSeats = totalSeats / 2;
            const fptp = calculateFPTP(votes, totalSeats / 2);
            const proportional = calculateProportional(votes, threshold, proportionalSeats);

            return proportional.map((p, i) => p + fptp[i]);
        }

        // Animate to new results
        function updateResults() {
            const newProportional = calculateProportional(state.votes, state.threshold, state.totalSeats);
            const newFptp = calculateFPTP(state.votes, state.totalSeats);
            const newMixed = calculateMixed(state.votes, state.threshold, state.totalSeats);

            animationState.targetProportional = newProportional;
            animationState.targetFptp = newFptp;
            animationState.targetMixed = newMixed;
            animationState.progress = 0;

            if (!animationState.proportional) {
                animationState.proportional = newProportional;
                animationState.fptp = newFptp;
                animationState.mixed = newMixed;
            }
        }

        // Draw visualization
        function draw() {
            const width = canvas.width / (window.devicePixelRatio || 1);
            const height = canvas.height / (window.devicePixelRatio || 1);

            ctx.fillStyle = 'rgba(0, 0, 0, 0)';
            ctx.fillRect(0, 0, width, height);

            if (!animationState.proportional) return;

            const systemWidth = (width - 60) / 3;
            const systemHeight = height - 80;
            const chartPadding = 40;

            const systems = [
                { name: 'VerhÃ¤ltniswahlrecht\n(D\'Hondt)', seats: animationState.proportional, x: 20 },
                { name: 'Mehrheitswahlrecht\n(FPTP)', seats: animationState.fptp, x: 20 + systemWidth + 20 },
                { name: 'Gemischtes System\n(50/50)', seats: animationState.mixed, x: 20 + (systemWidth + 20) * 2 }
            ];

            // Interpolate animation
            let displaySeats = systems.map(s => s.seats);
            if (animationState.progress < 1) {
                displaySeats = systems.map((s, idx) => {
                    const targets = [animationState.targetProportional, animationState.targetFptp, animationState.targetMixed];
                    return animationState[idx === 0 ? 'proportional' : idx === 1 ? 'fptp' : 'mixed'].map((v, i) => {
                        return v + (targets[idx][i] - v) * animationState.progress;
                    });
                });
            }

            // Draw each system
            systems.forEach((system, sysIdx) => {
                const x = system.x;
                const y = 30;

                // System title
                ctx.fillStyle = '#ffc107';
                ctx.font = '700 13px Inter';
                ctx.textAlign = 'center';
                const lines = system.name.split('\n');
                lines.forEach((line, i) => {
                    ctx.fillText(line, x + systemWidth / 2, y + i * 16);
                });

                const chartY = y + 40;
                const chartMaxHeight = height - chartY - 20;

                // Vote share bars (top)
                ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.fillRect(x + chartPadding, chartY, systemWidth - chartPadding * 2, 40);

                ctx.font = '11px Inter';
                ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                ctx.textAlign = 'left';
                ctx.fillText('Stimmen:', x + chartPadding, chartY - 5);

                const voteBarWidth = (systemWidth - chartPadding * 2) / parties.length;
                state.votes.forEach((vote, i) => {
                    const barHeight = (vote / 100) * 40;
                    ctx.fillStyle = parties[i].color;
                    ctx.globalAlpha = 0.7;
                    ctx.fillRect(x + chartPadding + i * voteBarWidth + 2, chartY + 40 - barHeight, voteBarWidth - 4, barHeight);
                    ctx.globalAlpha = 1;
                });

                // Seat distribution bars
                ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.fillRect(x + chartPadding, chartY + 80, systemWidth - chartPadding * 2, chartMaxHeight - 80);

                ctx.font = '11px Inter';
                ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                ctx.textAlign = 'left';
                ctx.fillText('Mandate:', x + chartPadding, chartY + 75);

                const maxSeats = Math.max(...displaySeats[sysIdx]);
                const seatBarWidth = (systemWidth - chartPadding * 2) / parties.length;

                displaySeats[sysIdx].forEach((seats, i) => {
                    const barHeight = (seats / state.totalSeats) * (chartMaxHeight - 80);
                    ctx.fillStyle = parties[i].color;
                    ctx.fillRect(x + chartPadding + i * seatBarWidth + 2, chartY + 80 + chartMaxHeight - 80 - barHeight, seatBarWidth - 4, barHeight);

                    // Seat count text
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '700 12px Inter';
                    ctx.textAlign = 'center';
                    ctx.fillText(Math.round(seats), x + chartPadding + i * seatBarWidth + seatBarWidth / 2, chartY + 80 + chartMaxHeight - 80 - barHeight - 5);
                });

                // Grid lines
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.lineWidth = 1;
                for (let i = 0; i <= 5; i++) {
                    const gridY = chartY + 80 + (chartMaxHeight - 80) * (i / 5);
                    ctx.beginPath();
                    ctx.moveTo(x + chartPadding, gridY);
                    ctx.lineTo(x + systemWidth - chartPadding, gridY);
                    ctx.stroke();
                }
            });
        }

        // Update info box
        function updateInfo() {
            const proportional = calculateProportional(state.votes, state.threshold, state.totalSeats);
            const fptp = calculateFPTP(state.votes, state.totalSeats);
            const mixed = calculateMixed(state.votes, state.threshold, state.totalSeats);

            let info = `<strong>Schwellenwert:</strong> ${state.threshold}%<br>`;
            info += `<strong>VerhÃ¤ltniswahlrecht:</strong> `;
            proportional.forEach((s, i) => {
                if (s > 0) info += `${parties[i].abbr}: ${s} `;
            });
            info += `<br><strong>Mehrheitswahlrecht:</strong> `;
            fptp.forEach((s, i) => {
                if (s > 0) info += `${parties[i].abbr}: ${s} `;
            });
            info += `<br><strong>Gemischtes System:</strong> `;
            mixed.forEach((s, i) => {
                if (s > 0) info += `${parties[i].abbr}: ${s} `;
            });

            document.getElementById('infoContent').innerHTML = info;
        }

        // Create party controls
        function createPartyControls() {
            const container = document.getElementById('partyControls');
            container.innerHTML = '';

            parties.forEach((party, i) => {
                const control = document.createElement('div');
                control.className = 'party-control';

                const label = document.createElement('div');
                label.className = 'party-label';

                const nameSpan = document.createElement('span');
                const colorDiv = document.createElement('div');
                colorDiv.className = 'party-color';
                colorDiv.style.backgroundColor = party.color;
                nameSpan.appendChild(colorDiv);
                nameSpan.appendChild(document.createTextNode(party.name));

                const valueSpan = document.createElement('span');
                valueSpan.className = 'party-value';

                label.appendChild(nameSpan);
                label.appendChild(valueSpan);

                const slider = document.createElement('input');
                slider.type = 'range';
                slider.min = '0';
                slider.max = '100';
                slider.value = state.votes[i];
                slider.addEventListener('input', (e) => {
                    state.votes[i] = parseInt(e.target.value);
                    normalizeVotes();
                    updatePartyValues();
                    updateResults();
                    updateInfo();
                });

                control.appendChild(label);
                control.appendChild(slider);
                container.appendChild(control);
            });
        }

        // Normalize votes to sum to 100
        function normalizeVotes() {
            const sum = state.votes.reduce((a, b) => a + b, 0);
            if (sum > 0) {
                state.votes = state.votes.map(v => (v / sum) * 100);
            }
            updatePartyValues();
        }

        // Update displayed party values
        function updatePartyValues() {
            const sliders = document.querySelectorAll('.party-control input[type="range"]');
            sliders.forEach((slider, i) => {
                slider.value = state.votes[i];
                const control = slider.closest('.party-control');
                const valueSpan = control.querySelector('.party-value');
                valueSpan.textContent = Math.round(state.votes[i]) + '%';
            });
        }

        // Event listeners
        document.getElementById('scenarioSelect').addEventListener('change', (e) => {
            const scenario = scenarios[e.target.value];
            state.votes = [...scenario.votes];
            updatePartyValues();
            updateResults();
            updateInfo();
            document.getElementById('infoBox').querySelector('#infoContent').textContent = scenario.info;
        });

        document.getElementById('thresholdSlider').addEventListener('input', (e) => {
            state.threshold = parseFloat(e.target.value);
            document.getElementById('thresholdValue').textContent = state.threshold.toFixed(1) + '%';
            updateResults();
            updateInfo();
        });

        function resetToDefaults() {
            state.votes = [30, 25, 20, 15, 10];
            state.threshold = 4;
            document.getElementById('scenarioSelect').value = 'austria2024';
            document.getElementById('thresholdSlider').value = 4;
            document.getElementById('thresholdValue').textContent = '4%';
            updatePartyValues();
            updateResults();
            updateInfo();
        }

        function randomize() {
            state.votes = Array(5).fill(0).map(() => Math.random() * 100);
            normalizeVotes();
            updateResults();
            updateInfo();
        }

        // Animation loop
        function animate() {
            if (animationState.progress < 1) {
                animationState.progress = Math.min(1, animationState.progress + 0.05);

                if (animationState.progress === 1) {
                    animationState.proportional = animationState.targetProportional;
                    animationState.fptp = animationState.targetFptp;
                    animationState.mixed = animationState.targetMixed;
                }
            }

            draw();
            requestAnimationFrame(animate);
        }

        // Initialize
        createPartyControls();
        updatePartyValues();
        updateResults();
        updateInfo();
        animate();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Industrialisierung und Urbanisierung - Simulation</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1a0a0a 0%, #3d1020 50%, #5c1030 100%);
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 8px 12px;
            gap: 6px;
        }

        /* Header */
        .header {
            max-height: 36px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 193, 7, 0.2);
        }

        .header h1 {
            font-size: 16px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .year-display {
            font-size: 20px;
            font-weight: 700;
            color: #ffc107;
            min-width: 80px;
            text-align: right;
        }

        /* Canvas Container */
        .canvas-wrapper {
            flex: 1;
            min-height: 0;
            position: relative;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            border: 1px solid rgba(255, 193, 7, 0.15);
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* Controls Strip */
        .controls {
            display: flex;
            gap: 8px;
            align-items: center;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 193, 7, 0.2);
            flex-wrap: wrap;
            max-height: 60px;
            overflow-y: auto;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .control-label {
            font-size: 11px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        /* Buttons */
        .btn {
            padding: 5px 10px;
            background: rgba(255, 193, 7, 0.15);
            border: 1px solid rgba(255, 193, 7, 0.4);
            color: #ffc107;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            font-family: 'Inter', sans-serif;
            white-space: nowrap;
        }

        .btn:hover {
            background: rgba(255, 193, 7, 0.25);
            border-color: rgba(255, 193, 7, 0.6);
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.active {
            background: rgba(255, 193, 7, 0.35);
            box-shadow: 0 0 12px rgba(255, 193, 7, 0.3);
        }

        /* Slider */
        .slider-container {
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
            min-width: 150px;
        }

        input[type="range"] {
            flex: 1;
            height: 4px;
            background: rgba(255, 193, 7, 0.2);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #ffc107;
            cursor: pointer;
            box-shadow: 0 0 8px rgba(255, 193, 7, 0.5);
            transition: all 0.2s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.3);
            box-shadow: 0 0 12px rgba(255, 193, 7, 0.7);
        }

        input[type="range"]::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #ffc107;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 8px rgba(255, 193, 7, 0.5);
            transition: all 0.2s;
        }

        .slider-label {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.5);
            min-width: 28px;
            text-align: center;
        }

        /* Stats Panel */
        .stats {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 2px;
            padding: 4px 8px;
            background: rgba(255, 193, 7, 0.08);
            border-radius: 4px;
            border: 1px solid rgba(255, 193, 7, 0.15);
            min-width: 70px;
        }

        .stat-label {
            font-size: 9px;
            font-weight: 600;
            color: rgba(255, 193, 7, 0.8);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .stat-value {
            font-size: 13px;
            font-weight: 700;
            color: #ffc107;
        }

        /* Scrollbar styling for small screens */
        ::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 193, 7, 0.2);
            border-radius: 2px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 193, 7, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Industrialisierung & Urbanisierung (1750–1900)</h1>
            <div class="year-display" id="yearDisplay">1750</div>
        </div>

        <!-- Canvas -->
        <div class="canvas-wrapper">
            <canvas id="simulationCanvas"></canvas>
        </div>

        <!-- Controls -->
        <div class="controls">
            <!-- Timeline -->
            <div class="control-group" style="flex: 1; min-width: 150px;">
                <div class="control-label">Timeline</div>
                <div class="slider-container">
                    <span class="slider-label">1750</span>
                    <input type="range" id="yearSlider" min="1750" max="1900" value="1750" step="1">
                    <span class="slider-label">1900</span>
                </div>
            </div>

            <!-- Play/Pause -->
            <div class="control-group">
                <button class="btn" id="playBtn">▶ Abspielen</button>
            </div>

            <!-- Speed Control -->
            <div class="control-group">
                <div class="control-label">Tempo</div>
                <button class="btn speed-btn" data-speed="1">1×</button>
                <button class="btn speed-btn" data-speed="2">2×</button>
                <button class="btn speed-btn" data-speed="4">4×</button>
            </div>

            <!-- Stats -->
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-label">Stadt %</div>
                    <div class="stat-value" id="urbanStat">10%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Land %</div>
                    <div class="stat-value" id="ruralStat">90%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Fabriken</div>
                    <div class="stat-value" id="factoryStat">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Luft</div>
                    <div class="stat-value" id="airQualityStat">Gut</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Kinderarbeit</div>
                    <div class="stat-value" id="childLaborStat">0%</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== DATA MODEL ====================
        const yearDataPoints = {
            1750: { urbanPct: 10, factories: 0, hasRailway: false },
            1800: { urbanPct: 25, factories: 5, hasRailway: false },
            1830: { urbanPct: 40, factories: 15, hasRailway: true },
            1850: { urbanPct: 55, factories: 30, hasRailway: true },
            1880: { urbanPct: 70, factories: 50, hasRailway: true },
            1900: { urbanPct: 80, factories: 60, hasRailway: true }
        };

        // ==================== STATE ====================
        let state = {
            year: 1750,
            isPlaying: false,
            speed: 1,
            population: { urban: 0, rural: 0 },
            factories: 0,
            hasRailway: false,
            airQuality: 100,
            childLabor: 0
        };

        // ==================== DOM ELEMENTS ====================
        const canvas = document.getElementById('simulationCanvas');
        const ctx = canvas.getContext('2d');
        const yearSlider = document.getElementById('yearSlider');
        const playBtn = document.getElementById('playBtn');
        const yearDisplay = document.getElementById('yearDisplay');
        const speedBtns = document.querySelectorAll('.speed-btn');
        const statElements = {
            urban: document.getElementById('urbanStat'),
            rural: document.getElementById('ruralStat'),
            factory: document.getElementById('factoryStat'),
            airQuality: document.getElementById('airQualityStat'),
            childLabor: document.getElementById('childLaborStat')
        };

        // ==================== CANVAS SETUP ====================
        function resizeCanvas() {
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
        }

        window.addEventListener('resize', resizeCanvas);
        setTimeout(resizeCanvas, 50);

        // ==================== ANIMATION DATA ====================
        let people = [];
        let smokeParticles = [];

        class Person {
            constructor(year) {
                this.year = year;
                const data = interpolateYearData(year);
                const isUrban = Math.random() < data.urbanPct / 100;

                if (isUrban) {
                    this.x = canvas.width * 0.65 + Math.random() * canvas.width * 0.25;
                    this.targetX = canvas.width * 0.65 + Math.random() * canvas.width * 0.25;
                } else {
                    this.x = canvas.width * 0.1 + Math.random() * canvas.width * 0.2;
                    this.targetX = canvas.width * 0.65 + Math.random() * canvas.width * 0.25;
                }

                this.y = canvas.height * 0.5 + Math.random() * canvas.height * 0.3;
                this.targetY = this.y;
                this.speed = 0.1 + Math.random() * 0.15;
                this.migrationStartYear = year + Math.random() * (1900 - year);
                this.size = 2 + Math.random() * 1.5;
            }

            update(year) {
                if (year >= this.migrationStartYear && this.x < this.targetX - 2) {
                    this.x += this.speed;
                }
            }

            draw(ctx) {
                ctx.fillStyle = 'rgba(255, 193, 7, 0.6)';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        class SmokeParticle {
            constructor(x, y) {
                this.x = x + (Math.random() - 0.5) * 20;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = -1 - Math.random() * 0.5;
                this.alpha = 0.5;
                this.decay = 0.01 + Math.random() * 0.01;
                this.size = 8 + Math.random() * 12;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.alpha -= this.decay;
            }

            draw(ctx) {
                ctx.fillStyle = `rgba(150, 150, 150, ${this.alpha})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // ==================== DATA INTERPOLATION ====================
        function interpolateYearData(year) {
            const years = Object.keys(yearDataPoints).map(Number).sort((a, b) => a - b);

            if (year <= years[0]) return yearDataPoints[years[0]];
            if (year >= years[years.length - 1]) return yearDataPoints[years[years.length - 1]];

            for (let i = 0; i < years.length - 1; i++) {
                const y1 = years[i];
                const y2 = years[i + 1];

                if (year >= y1 && year <= y2) {
                    const t = (year - y1) / (y2 - y1);
                    const d1 = yearDataPoints[y1];
                    const d2 = yearDataPoints[y2];

                    return {
                        urbanPct: d1.urbanPct + (d2.urbanPct - d1.urbanPct) * t,
                        factories: Math.round(d1.factories + (d2.factories - d1.factories) * t),
                        hasRailway: year >= 1830
                    };
                }
            }
        }

        // ==================== INITIALIZATION ====================
        function initPeople(year) {
            people = [];
            const totalPeople = 100;
            for (let i = 0; i < totalPeople; i++) {
                people.push(new Person(year));
            }
        }

        initPeople(1750);

        // ==================== UPDATE LOGIC ====================
        function updateState() {
            const data = interpolateYearData(state.year);
            state.population.urban = Math.round((data.urbanPct / 100) * 100);
            state.population.rural = 100 - state.population.urban;
            state.factories = data.factories;
            state.hasRailway = data.hasRailway;
            state.airQuality = Math.max(20, 100 - data.factories * 0.5);
            state.childLabor = Math.round(data.factories * 0.8);

            people.forEach(p => p.update(state.year));

            // Generate smoke from factories
            if (state.factories > 0 && Math.random() < 0.6) {
                const factoryX = canvas.width * (0.7 + Math.random() * 0.2);
                const factoryBaseY = canvas.height * 0.55;
                smokeParticles.push(new SmokeParticle(factoryX, factoryBaseY - 30));
            }

            smokeParticles = smokeParticles.filter(p => {
                p.update();
                return p.alpha > 0;
            });
        }

        // ==================== DRAWING ====================
        function drawScene() {
            const width = canvas.getBoundingClientRect().width;
            const height = canvas.getBoundingClientRect().height;

            // Background
            ctx.fillStyle = 'linear-gradient(180deg, #87ceeb 0%, #e0f6ff 100%)';
            ctx.fillRect(0, 0, width, height);

            // Ground
            ctx.fillStyle = '#8B7355';
            ctx.fillRect(0, height * 0.65, width, height * 0.35);

            // Grass
            ctx.fillStyle = '#2d5016';
            ctx.fillRect(0, height * 0.55, width, height * 0.1);

            // ===== LEFT SIDE: RURAL =====
            drawRuralScene(width, height);

            // ===== RIGHT SIDE: URBAN =====
            drawUrbanScene(width, height);

            // ===== PEOPLE =====
            people.forEach(p => p.draw(ctx));

            // ===== SMOKE =====
            smokeParticles.forEach(p => p.draw(ctx));

            // Dividing line
            ctx.strokeStyle = 'rgba(255, 193, 7, 0.2)';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(width * 0.5, 0);
            ctx.lineTo(width * 0.5, height);
            ctx.stroke();
            ctx.setLineDash([]);

            // Labels
            ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.font = 'bold 12px Inter';
            ctx.textAlign = 'center';
            ctx.fillText('Ländlich', width * 0.25, 20);
            ctx.fillText('Urban', width * 0.75, 20);
        }

        function drawRuralScene(width, height) {
            const baseY = height * 0.5;

            // Draw fields
            ctx.fillStyle = 'rgba(61, 128, 47, 0.3)';
            for (let i = 0; i < 3; i++) {
                ctx.fillRect(width * 0.05, baseY + i * 15, width * 0.3, 12);
            }

            // Draw houses
            drawHouse(ctx, width * 0.1, baseY - 40, 25, '#d4a574');
            drawHouse(ctx, width * 0.2, baseY - 35, 22, '#c9956f');
            drawHouse(ctx, width * 0.3, baseY - 38, 24, '#deb887');

            // Draw people in rural area
            ctx.fillStyle = 'rgba(255, 193, 7, 0.5)';
            for (let i = 0; i < 5; i++) {
                ctx.beginPath();
                ctx.arc(width * (0.08 + i * 0.08), baseY + 20, 2, 0, Math.PI * 2);
                ctx.fill();
            }

            // Trees
            drawTree(ctx, width * 0.35, baseY - 30, 15);
            drawTree(ctx, width * 0.42, baseY - 25, 12);
        }

        function drawUrbanScene(width, height) {
            const baseY = height * 0.5;

            // Draw factories
            for (let i = 0; i < state.factories; i++) {
                const progress = state.factories > 0 ? Math.min(1, (state.year - 1800) / 50) : 0;
                const alpha = progress;

                const factoryX = width * (0.65 + (i % 3) * 0.08);
                const factoryY = baseY - 40;
                const factorySize = 20 + (i % 3) * 3;

                ctx.globalAlpha = alpha;
                drawFactory(ctx, factoryX, factoryY, factorySize);
                ctx.globalAlpha = 1;
            }

            // Draw buildings
            for (let i = 0; i < 4; i++) {
                const buildingX = width * (0.72 + i * 0.06);
                const buildingY = baseY - 30;
                drawBuilding(ctx, buildingX, buildingY, 18 + i * 2, '#8b7355');
            }

            // Railway
            if (state.hasRailway) {
                drawRailway(ctx, width, baseY + 40);
            }

            // Dense population indicator
            ctx.fillStyle = 'rgba(255, 193, 7, 0.7)';
            for (let i = 0; i < Math.min(20, state.factories); i++) {
                ctx.beginPath();
                ctx.arc(
                    width * (0.65 + Math.random() * 0.3),
                    baseY + Math.random() * 40,
                    1.5,
                    0,
                    Math.PI * 2
                );
                ctx.fill();
            }
        }

        function drawHouse(ctx, x, y, size, color) {
            ctx.fillStyle = color;
            ctx.fillRect(x, y, size, size * 0.7);

            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x + size / 2, y - size * 0.4);
            ctx.lineTo(x + size, y);
            ctx.fill();

            ctx.fillStyle = '#654321';
            ctx.fillRect(x + size * 0.35, y + size * 0.3, size * 0.3, size * 0.25);
        }

        function drawFactory(ctx, x, y, size) {
            ctx.fillStyle = '#505050';
            ctx.fillRect(x, y, size, size);

            ctx.fillStyle = '#282828';
            ctx.fillRect(x + size * 0.2, y - size * 0.8, size * 0.15, size * 0.8);
            ctx.fillRect(x + size * 0.65, y - size * 0.9, size * 0.15, size * 0.9);

            ctx.fillStyle = '#333333';
            ctx.fillRect(x + size * 0.1, y, size * 0.8, size * 0.15);
        }

        function drawBuilding(ctx, x, y, size, color) {
            ctx.fillStyle = color;
            ctx.fillRect(x, y, size, size * 1.5);

            ctx.fillStyle = '#333333';
            for (let row = 0; row < 3; row++) {
                for (let col = 0; col < 2; col++) {
                    ctx.fillRect(x + col * size * 0.45 + 2, y + row * (size * 0.35) + 2, size * 0.35, size * 0.25);
                }
            }
        }

        function drawTree(ctx, x, y, size) {
            ctx.fillStyle = '#654321';
            ctx.fillRect(x - 2, y + size, 4, size * 0.5);

            ctx.fillStyle = '#2d5016';
            ctx.beginPath();
            ctx.arc(x, y, size * 0.6, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawRailway(ctx, width, y) {
            ctx.strokeStyle = '#8b7355';
            ctx.lineWidth = 8;
            ctx.beginPath();
            ctx.moveTo(width * 0.65, y);
            ctx.lineTo(width * 0.95, y);
            ctx.stroke();

            ctx.strokeStyle = '#444444';
            ctx.lineWidth = 2;
            for (let x = width * 0.65; x < width * 0.95; x += 15) {
                ctx.beginPath();
                ctx.moveTo(x, y - 4);
                ctx.lineTo(x, y + 4);
                ctx.stroke();
            }

            // Train
            const trainX = width * (0.65 + ((state.year - 1830) / 70) * 0.3);
            drawTrain(ctx, trainX, y - 15);
        }

        function drawTrain(ctx, x, y) {
            ctx.fillStyle = '#c41e3a';
            ctx.fillRect(x, y, 20, 12);
            ctx.fillRect(x + 20, y, 15, 12);

            ctx.fillStyle = '#333333';
            ctx.beginPath();
            ctx.arc(x + 5, y + 12, 3, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(x + 28, y + 12, 3, 0, Math.PI * 2);
            ctx.fill();
        }

        // ==================== ANIMATION LOOP ====================
        function animate() {
            updateState();
            drawScene();
            updateStats();
            requestAnimationFrame(animate);
        }

        animate();

        // ==================== UI UPDATES ====================
        function updateStats() {
            statElements.urban.textContent = state.population.urban + '%';
            statElements.rural.textContent = state.population.rural + '%';
            statElements.factory.textContent = state.factories;
            statElements.childLabor.textContent = state.childLabor + '%';

            if (state.airQuality > 75) {
                statElements.airQuality.textContent = 'Gut';
                statElements.airQuality.style.color = '#4ade80';
            } else if (state.airQuality > 50) {
                statElements.airQuality.textContent = 'Mittel';
                statElements.airQuality.style.color = '#fbbf24';
            } else {
                statElements.airQuality.textContent = 'Schlecht';
                statElements.airQuality.style.color = '#ef4444';
            }

            yearDisplay.textContent = Math.round(state.year);
        }

        // ==================== CONTROLS ====================
        yearSlider.addEventListener('input', (e) => {
            state.year = parseInt(e.target.value);
            state.isPlaying = false;
            playBtn.textContent = '▶ Abspielen';
            playBtn.classList.remove('active');
        });

        playBtn.addEventListener('click', () => {
            state.isPlaying = !state.isPlaying;
            playBtn.textContent = state.isPlaying ? '⏸ Pause' : '▶ Abspielen';
            playBtn.classList.toggle('active');
        });

        speedBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                speedBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.speed = parseInt(btn.dataset.speed);
            });
        });

        speedBtns[0].classList.add('active');

        // ==================== ANIMATION LOOP FOR YEAR PROGRESSION ====================
        setInterval(() => {
            if (state.isPlaying) {
                state.year = Math.min(1900, state.year + state.speed * 0.5);
                yearSlider.value = state.year;

                if (state.year >= 1900) {
                    state.isPlaying = false;
                    playBtn.textContent = '▶ Abspielen';
                    playBtn.classList.remove('active');
                }
            }
        }, 100);
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blutkreislauf-Simulation</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }
        .container { max-width: 100%; margin: 0 auto; padding: 0 10px; }
        h1 { text-align: center; margin-bottom: 10px; font-size: 1.8em; color: #4fc3f7; }
        .subtitle { text-align: center; color: #90a4ae; margin-bottom: 20px; }
        .simulation-area {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        canvas {
            display: block;
            margin: 0 auto;
            background: radial-gradient(ellipse at center, #1a1a3e 0%, #0d0d1a 100%);
            border-radius: 10px;
            border: 2px solid #4fc3f7;
            max-width: 100%;
            height: auto;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .control-group {
            text-align: center;
        }
        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #90a4ae;
        }
        .slider {
            width: 150px;
            height: 8px;
            -webkit-appearance: none;
            background: linear-gradient(90deg, #3498db, #e74c3c);
            border-radius: 4px;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
        }
        .control-btn {
            padding: 12px 25px;
            font-size: 1em;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }
        .control-btn:hover { transform: translateY(-2px); }
        .control-btn.play { background: linear-gradient(135deg, #2ecc71, #27ae60); color: white; }
        .control-btn.pause { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; }
        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .stat-box {
            background: rgba(0,0,0,0.3);
            padding: 15px 25px;
            border-radius: 15px;
            text-align: center;
        }
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #e74c3c;
        }
        .stat-label {
            font-size: 0.85em;
            color: #90a4ae;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }
        .legend-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
        .info-box {
            background: rgba(79, 195, 247, 0.1);
            border-left: 4px solid #4fc3f7;
            padding: 15px 20px;
            border-radius: 0 10px 10px 0;
            margin-top: 20px;
        }
        .info-box h3 { color: #4fc3f7; margin-bottom: 10px; }
        .info-box p { line-height: 1.6; color: #b0bec5; }
        .organ-info {
            text-align: center;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            margin-top: 10px;
            min-height: 60px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ù§Ô∏è Blutkreislauf-Simulation</h1>
        <p class="subtitle">3. Klasse Biologie ‚Äì Verfolge den Weg des Blutes</p>

        <div class="simulation-area">
            <canvas id="circulationCanvas" width="800" height="550"></canvas>

            <div class="stats">
                <div class="stat-box">
                    <div class="stat-value" id="heartRate">72</div>
                    <div class="stat-label">Herzfrequenz (bpm)</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" style="color: #3498db;" id="o2Level">98%</div>
                    <div class="stat-label">O‚ÇÇ-S√§ttigung</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" style="color: #9b59b6;" id="bloodCells">~5 Mio</div>
                    <div class="stat-label">Rote Blutzellen/¬µl</div>
                </div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>üíì Herzfrequenz</label>
                    <input type="range" class="slider" id="rateSlider" min="40" max="180" value="72">
                </div>
                <button class="control-btn play" id="playBtn" onclick="togglePlay()">‚è∏ Pause</button>
            </div>

            <div class="organ-info" id="organInfo">
                Bewege die Maus √ºber die Organe, um mehr zu erfahren
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-dot" style="background: #e74c3c;"></div>
                    <span>Sauerstoffreiches Blut</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #3498db;"></div>
                    <span>Sauerstoffarmes Blut</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #9b59b6;"></div>
                    <span>Gasaustausch</span>
                </div>
            </div>
        </div>

        <div class="info-box">
            <h3>üìö Der Blutkreislauf</h3>
            <p>Das Herz pumpt Blut durch zwei Kreisl√§ufe: Im <strong>Lungenkreislauf</strong> (kleiner Kreislauf)
            nimmt das Blut in der Lunge Sauerstoff auf. Im <strong>K√∂rperkreislauf</strong> (gro√üer Kreislauf)
            verteilt es den Sauerstoff an alle Organe und nimmt CO‚ÇÇ auf. Das Herz schl√§gt etwa 100.000 mal pro Tag!</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('circulationCanvas');
        const ctx = canvas.getContext('2d');

        let heartRate = 72;
        let isPlaying = true;
        let time = 0;
        let heartPhase = 0;
        let bloodCells = [];

        const organInfo = {
            heart: '‚ù§Ô∏è Herz: Pumpt das Blut durch den K√∂rper. Hat 4 Kammern: 2 Vorh√∂fe und 2 Ventrikel.',
            lungs: 'ü´Å Lunge: Hier findet der Gasaustausch statt. O‚ÇÇ wird aufgenommen, CO‚ÇÇ abgegeben.',
            brain: 'üß† Gehirn: Braucht st√§ndig Sauerstoff und Glukose. Verbraucht 20% des Sauerstoffs!',
            body: 'ü¶µ K√∂rpergewebe: Muskeln und Organe nehmen O‚ÇÇ auf und geben CO‚ÇÇ ab.',
            liver: 'ü´Ä Leber: Entgiftet das Blut und speichert N√§hrstoffe.'
        };

        class BloodCell {
            constructor(path, offset) {
                this.path = path;
                this.progress = offset;
                this.speed = 0.003;
            }

            update(speedMultiplier) {
                this.progress += this.speed * speedMultiplier;
                if (this.progress > 1) this.progress -= 1;
            }

            getPosition() {
                const idx = Math.floor(this.progress * (this.path.length - 1));
                const nextIdx = (idx + 1) % this.path.length;
                const t = (this.progress * (this.path.length - 1)) % 1;

                return {
                    x: this.path[idx].x + (this.path[nextIdx].x - this.path[idx].x) * t,
                    y: this.path[idx].y + (this.path[nextIdx].y - this.path[idx].y) * t,
                    oxygenated: this.path[idx].oxygenated
                };
            }

            draw() {
                const pos = this.getPosition();
                const color = pos.oxygenated ? '#e74c3c' : '#3498db';

                ctx.beginPath();
                ctx.arc(pos.x, pos.y, 6, 0, Math.PI * 2);
                ctx.fillStyle = color;
                ctx.fill();

                // Glow
                ctx.beginPath();
                ctx.arc(pos.x, pos.y, 8, 0, Math.PI * 2);
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.globalAlpha = 0.5;
                ctx.stroke();
                ctx.globalAlpha = 1;
            }
        }

        // Define circulation paths
        const bodyPath = [
            // From heart (left ventricle) through aorta
            { x: 400, y: 280, oxygenated: true },
            { x: 400, y: 230, oxygenated: true },
            { x: 400, y: 180, oxygenated: true },
            // To body/brain
            { x: 350, y: 120, oxygenated: true },
            { x: 300, y: 100, oxygenated: true },
            { x: 250, y: 120, oxygenated: true },
            // In body (deoxygenating)
            { x: 200, y: 180, oxygenated: false },
            { x: 180, y: 280, oxygenated: false },
            { x: 180, y: 380, oxygenated: false },
            { x: 200, y: 450, oxygenated: false },
            // Return to heart
            { x: 280, y: 480, oxygenated: false },
            { x: 360, y: 450, oxygenated: false },
            { x: 380, y: 380, oxygenated: false },
            { x: 380, y: 320, oxygenated: false },
            { x: 390, y: 290, oxygenated: false },
        ];

        const lungPath = [
            // From heart (right ventricle) to lungs
            { x: 410, y: 290, oxygenated: false },
            { x: 420, y: 320, oxygenated: false },
            { x: 450, y: 350, oxygenated: false },
            { x: 500, y: 350, oxygenated: false },
            // In lungs (oxygenating)
            { x: 550, y: 300, oxygenated: false },
            { x: 580, y: 250, oxygenated: true },
            { x: 600, y: 200, oxygenated: true },
            { x: 580, y: 150, oxygenated: true },
            { x: 530, y: 130, oxygenated: true },
            { x: 480, y: 150, oxygenated: true },
            // Return to heart
            { x: 450, y: 200, oxygenated: true },
            { x: 420, y: 240, oxygenated: true },
            { x: 405, y: 270, oxygenated: true },
        ];

        // Create blood cells
        for (let i = 0; i < 12; i++) {
            bloodCells.push(new BloodCell(bodyPath, i / 12));
        }
        for (let i = 0; i < 8; i++) {
            bloodCells.push(new BloodCell(lungPath, i / 8));
        }

        function drawHeart() {
            const scale = 1 + Math.sin(heartPhase) * 0.05;
            const cx = 400, cy = 280;

            ctx.save();
            ctx.translate(cx, cy);
            ctx.scale(scale, scale);
            ctx.translate(-cx, -cy);

            // Heart shape
            ctx.beginPath();
            ctx.moveTo(400, 320);
            ctx.bezierCurveTo(400, 300, 360, 260, 360, 240);
            ctx.bezierCurveTo(360, 210, 390, 200, 400, 220);
            ctx.bezierCurveTo(410, 200, 440, 210, 440, 240);
            ctx.bezierCurveTo(440, 260, 400, 300, 400, 320);

            const gradient = ctx.createRadialGradient(400, 260, 10, 400, 280, 60);
            gradient.addColorStop(0, '#c0392b');
            gradient.addColorStop(1, '#7f1d1d');
            ctx.fillStyle = gradient;
            ctx.fill();

            // Heart chambers divider
            ctx.strokeStyle = '#5c1515';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(400, 230);
            ctx.lineTo(400, 310);
            ctx.stroke();

            // Labels
            ctx.fillStyle = '#fff';
            ctx.font = '10px Segoe UI';
            ctx.textAlign = 'center';
            ctx.fillText('L', 380, 270);
            ctx.fillText('R', 420, 270);

            ctx.restore();
        }

        function drawLungs() {
            // Left lung
            ctx.beginPath();
            ctx.ellipse(560, 230, 70, 100, 0.2, 0, Math.PI * 2);
            const lungGradient = ctx.createRadialGradient(560, 230, 20, 560, 230, 80);
            lungGradient.addColorStop(0, '#ff9a9e');
            lungGradient.addColorStop(1, '#d66d75');
            ctx.fillStyle = lungGradient;
            ctx.fill();
            ctx.strokeStyle = '#9b59b6';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Lung details (bronchi)
            ctx.strokeStyle = 'rgba(255,255,255,0.3)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(500, 230);
            ctx.lineTo(540, 200);
            ctx.lineTo(560, 170);
            ctx.moveTo(540, 200);
            ctx.lineTo(560, 230);
            ctx.moveTo(540, 200);
            ctx.lineTo(570, 260);
            ctx.stroke();

            // Label
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 12px Segoe UI';
            ctx.textAlign = 'center';
            ctx.fillText('ü´Å Lunge', 560, 350);
        }

        function drawBody() {
            // Brain
            ctx.beginPath();
            ctx.ellipse(280, 100, 50, 35, 0, 0, Math.PI * 2);
            ctx.fillStyle = '#ffb6c1';
            ctx.fill();
            ctx.strokeStyle = '#e91e63';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Brain folds
            ctx.strokeStyle = 'rgba(255,255,255,0.4)';
            ctx.beginPath();
            ctx.moveTo(250, 90);
            ctx.quadraticCurveTo(270, 80, 290, 90);
            ctx.moveTo(260, 110);
            ctx.quadraticCurveTo(280, 100, 300, 110);
            ctx.stroke();

            ctx.fillStyle = '#fff';
            ctx.font = 'bold 11px Segoe UI';
            ctx.fillText('üß† Gehirn', 280, 145);

            // Body tissue
            ctx.beginPath();
            ctx.roundRect(150, 250, 80, 200, 15);
            ctx.fillStyle = 'rgba(241, 196, 15, 0.3)';
            ctx.fill();
            ctx.strokeStyle = '#f1c40f';
            ctx.lineWidth = 2;
            ctx.stroke();

            ctx.fillStyle = '#fff';
            ctx.font = 'bold 11px Segoe UI';
            ctx.fillText('ü¶µ K√∂rper', 190, 470);
        }

        function drawVessels() {
            // Aorta (red)
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 12;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(400, 280);
            ctx.quadraticCurveTo(400, 150, 300, 100);
            ctx.stroke();

            // Veins returning (blue)
            ctx.strokeStyle = '#3498db';
            ctx.beginPath();
            ctx.moveTo(380, 320);
            ctx.quadraticCurveTo(300, 400, 200, 350);
            ctx.stroke();

            // Pulmonary artery (blue to lungs)
            ctx.strokeStyle = '#3498db';
            ctx.beginPath();
            ctx.moveTo(420, 290);
            ctx.quadraticCurveTo(470, 320, 500, 280);
            ctx.stroke();

            // Pulmonary vein (red from lungs)
            ctx.strokeStyle = '#e74c3c';
            ctx.beginPath();
            ctx.moveTo(500, 200);
            ctx.quadraticCurveTo(450, 220, 400, 250);
            ctx.stroke();
        }

        function drawLabels() {
            ctx.fillStyle = 'rgba(0,0,0,0.6)';
            ctx.font = '11px Segoe UI';
            ctx.textAlign = 'center';

            // Circulation labels
            ctx.fillStyle = '#e74c3c';
            ctx.fillText('Arterien (O‚ÇÇ-reich)', 350, 160);

            ctx.fillStyle = '#3498db';
            ctx.fillText('Venen (O‚ÇÇ-arm)', 280, 400);

            ctx.fillStyle = '#9b59b6';
            ctx.fillText('Gasaustausch', 600, 280);
        }

        function getOrganAtPosition(x, y) {
            if (Math.sqrt((x-400)**2 + (y-280)**2) < 50) return 'heart';
            if (Math.sqrt((x-560)**2 + (y-230)**2) < 80) return 'lungs';
            if (Math.sqrt((x-280)**2 + (y-100)**2) < 50) return 'brain';
            if (x > 150 && x < 230 && y > 250 && y < 450) return 'body';
            return null;
        }

        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) * (canvas.width / rect.width);
            const y = (e.clientY - rect.top) * (canvas.height / rect.height);

            const organ = getOrganAtPosition(x, y);
            if (organ) {
                document.getElementById('organInfo').textContent = organInfo[organ];
                canvas.style.cursor = 'pointer';
            } else {
                document.getElementById('organInfo').textContent = 'Bewege die Maus √ºber die Organe, um mehr zu erfahren';
                canvas.style.cursor = 'default';
            }
        });

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (isPlaying) {
                time += 0.016;
                heartPhase += (heartRate / 60) * 0.1;
            }

            const speedMultiplier = heartRate / 72;

            drawVessels();
            drawBody();
            drawLungs();
            drawHeart();
            drawLabels();

            if (isPlaying) {
                bloodCells.forEach(cell => {
                    cell.update(speedMultiplier);
                });
            }

            bloodCells.forEach(cell => cell.draw());

            requestAnimationFrame(animate);
        }

        document.getElementById('rateSlider').addEventListener('input', (e) => {
            heartRate = parseInt(e.target.value);
            document.getElementById('heartRate').textContent = heartRate;

            // Update O2 based on heart rate
            let o2 = heartRate < 60 ? 95 : heartRate > 150 ? 92 : 98;
            document.getElementById('o2Level').textContent = o2 + '%';
        });

        function togglePlay() {
            isPlaying = !isPlaying;
            const btn = document.getElementById('playBtn');
            btn.textContent = isPlaying ? '‚è∏ Pause' : '‚ñ∂ Start';
            btn.className = 'control-btn ' + (isPlaying ? 'pause' : 'play');
        }

        animate();
    </script>
</body>
</html>
